!function t(e,n,i){function o(s,a){if(!n[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return o(n?n:t)},c,c.exports,t,e,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(t,e,n){(function(t){(function(t,e,n,i,o){var r=a;if(!s){var s={};s.modestmaps||(s.modestmaps={})}var a=s.modestmaps={noConflict:function(){return a=r,this}};!function(e){e.extend=function(t,e){for(var n in e.prototype)"undefined"==typeof t.prototype[n]&&(t.prototype[n]=e.prototype[n]);return t},e.getFrame=function(){return function(t){(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(function(){t(+new Date)},10)})(t)}}(),e.transformProperty=function(t){if(this.document){for(var e=document.documentElement.style,n=0;n<t.length;n++)if(t[n]in e)return t[n];return!1}}(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),e.matrixString=function(t){t.scale*t.width%1&&(t.scale+=(1-t.scale*t.width%1)/t.width);var n=t.scale||1;return e._browser.webkit3d?"translate3d("+t.x.toFixed(0)+"px,"+t.y.toFixed(0)+"px, 0px)scale3d("+n+","+n+", 1)":"translate("+t.x.toFixed(6)+"px,"+t.y.toFixed(6)+"px)scale("+n+","+n+")"},e._browser=function(t){return{webkit:"WebKitCSSMatrix"in t,webkit3d:"WebKitCSSMatrix"in t&&"m11"in new WebKitCSSMatrix}}(this),e.moveElement=function(t,n){if(e.transformProperty){n.scale||(n.scale=1),n.width||(n.width=0),n.height||(n.height=0);var i=e.matrixString(n);t[e.transformProperty]!==i&&(t.style[e.transformProperty]=t[e.transformProperty]=i)}else t.style.left=n.x+"px",t.style.top=n.y+"px",n.width&&n.height&&n.scale&&(t.style.width=Math.ceil(n.width*n.scale)+"px",t.style.height=Math.ceil(n.height*n.scale)+"px")},e.cancelEvent=function(t){return t.cancelBubble=!0,t.cancel=!0,t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),!1},e.coerceLayer=function(t){return"string"==typeof t?new e.Layer(new e.TemplatedLayer(t)):"draw"in t&&"function"==typeof t.draw?t:new e.Layer(t)},e.addEvent=function(t,e,n){t.addEventListener?(t.addEventListener(e,n,!1),"mousewheel"==e&&t.addEventListener("DOMMouseScroll",n,!1)):t.attachEvent&&(t["e"+e+n]=n,t[e+n]=function(){t["e"+e+n](window.event)},t.attachEvent("on"+e,t[e+n]))},e.removeEvent=function(t,e,n){t.removeEventListener?(t.removeEventListener(e,n,!1),"mousewheel"==e&&t.removeEventListener("DOMMouseScroll",n,!1)):t.detachEvent&&(t.detachEvent("on"+e,t[e+n]),t[e+n]=null)},e.getStyle=function(t,e){return t.currentStyle?t.currentStyle[e]:window.getComputedStyle?document.defaultView.getComputedStyle(t,null).getPropertyValue(e):void 0},e.Point=function(t,e){this.x=parseFloat(t),this.y=parseFloat(e)},e.Point.prototype={x:0,y:0,toString:function(){return"("+this.x.toFixed(3)+", "+this.y.toFixed(3)+")"},copy:function(){return new e.Point(this.x,this.y)}},e.Point.distance=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},e.Point.interpolate=function(t,n,i){return new e.Point(t.x+(n.x-t.x)*i,t.y+(n.y-t.y)*i)},e.Coordinate=function(t,e,n){this.row=t,this.column=e,this.zoom=n},e.Coordinate.prototype={row:0,column:0,zoom:0,toString:function(){return"("+this.row.toFixed(3)+", "+this.column.toFixed(3)+" @"+this.zoom.toFixed(3)+")"},toKey:function(){return this.zoom+","+this.row+","+this.column},copy:function(){return new e.Coordinate(this.row,this.column,this.zoom)},container:function(){return new e.Coordinate(Math.floor(this.row),Math.floor(this.column),Math.floor(this.zoom))},zoomTo:function(t){var n=Math.pow(2,t-this.zoom);return new e.Coordinate(this.row*n,this.column*n,t)},zoomBy:function(t){var n=Math.pow(2,t);return new e.Coordinate(this.row*n,this.column*n,this.zoom+t)},up:function(t){return void 0===t&&(t=1),new e.Coordinate(this.row-t,this.column,this.zoom)},right:function(t){return void 0===t&&(t=1),new e.Coordinate(this.row,this.column+t,this.zoom)},down:function(t){return void 0===t&&(t=1),new e.Coordinate(this.row+t,this.column,this.zoom)},left:function(t){return void 0===t&&(t=1),new e.Coordinate(this.row,this.column-t,this.zoom)}},e.Location=function(t,e){this.lat=parseFloat(t),this.lon=parseFloat(e)},e.Location.prototype={lat:0,lon:0,toString:function(){return"("+this.lat.toFixed(3)+", "+this.lon.toFixed(3)+")"},copy:function(){return new e.Location(this.lat,this.lon)}},e.Location.distance=function(t,e,n){n||(n=6378e3);var i=Math.PI/180,o=t.lat*i,r=t.lon*i,s=e.lat*i,a=e.lon*i,l=Math.cos(o)*Math.cos(r)*Math.cos(s)*Math.cos(a),u=Math.cos(o)*Math.sin(r)*Math.cos(s)*Math.sin(a),c=Math.sin(o)*Math.sin(s);return Math.acos(l+u+c)*n},e.Location.interpolate=function(t,n,i){if(t.lat===n.lat&&t.lon===n.lon)return new e.Location(t.lat,t.lon);var o=Math.PI/180,r=t.lat*o,s=t.lon*o,a=n.lat*o,l=n.lon*o,u=2*Math.asin(Math.sqrt(Math.pow(Math.sin(.5*(r-a)),2)+Math.cos(r)*Math.cos(a)*Math.pow(Math.sin(.5*(s-l)),2))),c=Math.sin((1-i)*u)/Math.sin(u),h=Math.sin(i*u)/Math.sin(u),d=c*Math.cos(r)*Math.cos(s)+h*Math.cos(a)*Math.cos(l),p=c*Math.cos(r)*Math.sin(s)+h*Math.cos(a)*Math.sin(l),f=c*Math.sin(r)+h*Math.sin(a),m=Math.atan2(f,Math.sqrt(Math.pow(d,2)+Math.pow(p,2))),v=Math.atan2(p,d);return new e.Location(m/o,v/o)},e.Location.bearing=function(t,e){var n=Math.PI/180,i=t.lat*n,o=t.lon*n,r=e.lat*n,s=e.lon*n,a=Math.atan2(Math.sin(o-s)*Math.cos(r),Math.cos(i)*Math.sin(r)-Math.sin(i)*Math.cos(r)*Math.cos(o-s))/-(Math.PI/180);return 0>a?a+360:a},e.Extent=function(t,n,i,o){if(t instanceof e.Location&&n instanceof e.Location){var r=t,s=n;t=r.lat,n=r.lon,i=s.lat,o=s.lon}isNaN(i)&&(i=t),isNaN(o)&&(o=n),this.north=Math.max(t,i),this.south=Math.min(t,i),this.east=Math.max(o,n),this.west=Math.min(o,n)},e.Extent.prototype={north:0,south:0,east:0,west:0,copy:function(){return new e.Extent(this.north,this.west,this.south,this.east)},toString:function(t){return isNaN(t)&&(t=3),[this.north.toFixed(t),this.west.toFixed(t),this.south.toFixed(t),this.east.toFixed(t)].join(", ")},northWest:function(){return new e.Location(this.north,this.west)},southEast:function(){return new e.Location(this.south,this.east)},northEast:function(){return new e.Location(this.north,this.east)},southWest:function(){return new e.Location(this.south,this.west)},center:function(){return new e.Location(this.south+.5*(this.north-this.south),this.east+.5*(this.west-this.east))},encloseLocation:function(t){t.lat>this.north&&(this.north=t.lat),t.lat<this.south&&(this.south=t.lat),t.lon>this.east&&(this.east=t.lon),t.lon<this.west&&(this.west=t.lon)},encloseLocations:function(t){for(var e=t.length,n=0;e>n;n++)this.encloseLocation(t[n])},setFromLocations:function(t){var e=t.length,n=t[0];this.north=this.south=n.lat,this.east=this.west=n.lon;for(var i=1;e>i;i++)this.encloseLocation(t[i])},encloseExtent:function(t){t.north>this.north&&(this.north=t.north),t.south<this.south&&(this.south=t.south),t.east>this.east&&(this.east=t.east),t.west<this.west&&(this.west=t.west)},containsLocation:function(t){return t.lat>=this.south&&t.lat<=this.north&&t.lon>=this.west&&t.lon<=this.east},toArray:function(){return[this.northWest(),this.southEast()]}},e.Extent.fromString=function(t){var n=t.split(/\s*,\s*/);if(4!=n.length)throw"Invalid extent string (expecting 4 comma-separated numbers)";return new e.Extent(parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]))},e.Extent.fromArray=function(t){var n=new e.Extent;return n.setFromLocations(t),n},e.Transformation=function(t,e,n,i,o,r){this.ax=t,this.bx=e,this.cx=n,this.ay=i,this.by=o,this.cy=r},e.Transformation.prototype={ax:0,bx:0,cx:0,ay:0,by:0,cy:0,transform:function(t){return new e.Point(this.ax*t.x+this.bx*t.y+this.cx,this.ay*t.x+this.by*t.y+this.cy)},untransform:function(t){return new e.Point((t.x*this.by-t.y*this.bx-this.cx*this.by+this.cy*this.bx)/(this.ax*this.by-this.ay*this.bx),(t.x*this.ay-t.y*this.ax-this.cx*this.ay+this.cy*this.ax)/(this.bx*this.ay-this.by*this.ax))}},e.deriveTransformation=function(t,n,i,o,r,s,a,l,u,c,h,d){var p=e.linearSolution(t,n,i,r,s,a,u,c,h),f=e.linearSolution(t,n,o,r,s,l,u,c,d);return new e.Transformation(p[0],p[1],p[2],f[0],f[1],f[2])},e.linearSolution=function(t,e,n,i,o,r,s,a,l){t=parseFloat(t),e=parseFloat(e),n=parseFloat(n),i=parseFloat(i),o=parseFloat(o),r=parseFloat(r),s=parseFloat(s),a=parseFloat(a),l=parseFloat(l);var u=((r-l)*(e-o)-(n-r)*(o-a))/((i-s)*(e-o)-(t-i)*(o-a)),c=((r-l)*(t-i)-(n-r)*(i-s))/((o-a)*(t-i)-(e-o)*(i-s)),h=n-t*u-e*c;return[u,c,h]},e.Projection=function(t,n){n||(n=new e.Transformation(1,0,0,0,1,0)),this.zoom=t,this.transformation=n},e.Projection.prototype={zoom:0,transformation:null,rawProject:function(t){throw"Abstract method not implemented by subclass."},rawUnproject:function(t){throw"Abstract method not implemented by subclass."},project:function(t){return t=this.rawProject(t),this.transformation&&(t=this.transformation.transform(t)),t},unproject:function(t){return this.transformation&&(t=this.transformation.untransform(t)),t=this.rawUnproject(t)},locationCoordinate:function(t){var n=new e.Point(Math.PI*t.lon/180,Math.PI*t.lat/180);return n=this.project(n),new e.Coordinate(n.y,n.x,this.zoom)},coordinateLocation:function(t){t=t.zoomTo(this.zoom);var n=new e.Point(t.column,t.row);return n=this.unproject(n),new e.Location(180*n.y/Math.PI,180*n.x/Math.PI)}},e.LinearProjection=function(t,n){e.Projection.call(this,t,n)},e.LinearProjection.prototype={rawProject:function(t){return new e.Point(t.x,t.y)},rawUnproject:function(t){return new e.Point(t.x,t.y)}},e.extend(e.LinearProjection,e.Projection),e.MercatorProjection=function(t,n){e.Projection.call(this,t,n)},e.MercatorProjection.prototype={rawProject:function(t){return new e.Point(t.x,Math.log(Math.tan(.25*Math.PI+.5*t.y)))},rawUnproject:function(t){return new e.Point(t.x,2*Math.atan(Math.pow(Math.E,t.y))-.5*Math.PI)}},e.extend(e.MercatorProjection,e.Projection),e.MapProvider=function(t){t&&(this.getTile=t)},e.MapProvider.prototype={tileLimits:[new e.Coordinate(0,0,0),new e.Coordinate(1,1,0).zoomTo(18)],getTileUrl:function(t){throw"Abstract method not implemented by subclass."},getTile:function(t){throw"Abstract method not implemented by subclass."},releaseTile:function(t){},setZoomRange:function(t,e){this.tileLimits[0]=this.tileLimits[0].zoomTo(t),this.tileLimits[1]=this.tileLimits[1].zoomTo(e)},sourceCoordinate:function(t){var n,i=this.tileLimits[0].zoomTo(t.zoom).container(),o=this.tileLimits[1].zoomTo(t.zoom),r=Math.pow(2,t.zoom);return o=new e.Coordinate(Math.ceil(o.row),Math.ceil(o.column),Math.floor(o.zoom)),n=t.column<0?(t.column%r+r)%r:t.column%r,t.row<i.row||t.row>=o.row?null:n<i.column||n>=o.column?null:new e.Coordinate(t.row,n,t.zoom)}},e.Template=function(t,n){function i(t,e,n){for(var i="",o=1;n>=o;o++)i+=(t>>n-o&1)<<1|e>>n-o&1;return i||"0"}var o=t.match(/{(Q|quadkey)}/);o&&(t=t.replace("{subdomain}","{S}").replace("{zoom}","{Z}").replace("{quadkey}","{Q}"));var r=n&&n.length&&t.indexOf("{S}")>=0,s=function(e){var s=this.sourceCoordinate(e);if(!s)return null;var a=t;if(r){var l=parseInt(s.zoom+s.row+s.column,10)%n.length;a=a.replace("{S}",n[l])}return o?a.replace("{Z}",s.zoom.toFixed(0)).replace("{Q}",i(s.row,s.column,s.zoom)):a.replace("{Z}",s.zoom.toFixed(0)).replace("{X}",s.column.toFixed(0)).replace("{Y}",s.row.toFixed(0))};e.MapProvider.call(this,s)},e.Template.prototype={getTile:function(t){return this.getTileUrl(t)}},e.extend(e.Template,e.MapProvider),e.TemplatedLayer=function(t,n,i){return new e.Layer(new e.Template(t,n),null,i)},e.getMousePoint=function(t,n){var i=new e.Point(t.clientX,t.clientY);i.x+=document.body.scrollLeft+document.documentElement.scrollLeft,i.y+=document.body.scrollTop+document.documentElement.scrollTop;for(var o=n.parent;o;o=o.offsetParent)i.x-=o.offsetLeft,i.y-=o.offsetTop;return i},e.MouseWheelHandler=function(){function t(t){var r=0;o=o||(new Date).getTime();try{i.scrollTop=1e3,i.dispatchEvent(t),r=1e3-i.scrollTop}catch(a){r=t.wheelDelta||5*-t.detail}var l=(new Date).getTime()-o,u=e.getMousePoint(t,n);return Math.abs(r)>0&&l>200&&!s?(n.zoomByAbout(r>0?1:-1,u),o=(new Date).getTime()):s&&n.zoomByAbout(.001*r,u),e.cancelEvent(t)}var n,i,o,r={id:"MouseWheelHandler"},s=!1;return r.init=function(o){n=o,i=document.body.appendChild(document.createElement("div")),i.style.cssText="visibility:hidden;top:0;height:0;width:0;overflow-y:scroll";var s=i.appendChild(document.createElement("div"));return s.style.height="2000px",e.addEvent(n.parent,"mousewheel",t),r},r.precise=function(t){return arguments.length?(s=t,r):s},r.remove=function(){e.removeEvent(n.parent,"mousewheel",t),i.parentNode.removeChild(i)},r},e.DoubleClickHandler=function(){function t(t){var i=e.getMousePoint(t,n);return n.zoomByAbout(t.shiftKey?-1:1,i),e.cancelEvent(t)}var n,i={id:"DoubleClickHandler"};return i.init=function(o){return n=o,e.addEvent(n.parent,"dblclick",t),i},i.remove=function(){e.removeEvent(n.parent,"dblclick",t)},i},e.DragHandler=function(){function t(t){return t.shiftKey||2==t.button?void 0:(e.addEvent(document,"mouseup",n),e.addEvent(document,"mousemove",i),o=new e.Point(t.clientX,t.clientY),r.parent.style.cursor="move",e.cancelEvent(t))}function n(t){return e.removeEvent(document,"mouseup",n),e.removeEvent(document,"mousemove",i),o=null,r.parent.style.cursor="",e.cancelEvent(t)}function i(t){return o&&(r.panBy(t.clientX-o.x,t.clientY-o.y),o.x=t.clientX,o.y=t.clientY,o.t=+new Date),e.cancelEvent(t)}var o,r,s={id:"DragHandler"};return s.init=function(n){return r=n,e.addEvent(r.parent,"mousedown",t),s},s.remove=function(){e.removeEvent(r.parent,"mousedown",t)},s},e.MouseHandler=function(){var t,n={id:"MouseHandler",handlers:[]};return n.init=function(i){return t=i,n.handlers=[e.DragHandler().init(t),e.DoubleClickHandler().init(t),e.MouseWheelHandler().init(t)],n},n.remove=function(){for(var t=0;t<n.handlers.length;t++)n.handlers[t].remove();return n.handlers=[],n},n},e.TouchHandler=function(){function t(){return"ontouchstart"in window||"onmsgesturechange"in window}function n(t){for(var e=0;e<t.touches.length;e+=1){var n=t.touches[e];if(n.identifier in g){var i=g[n.identifier];i.x=n.clientX,i.y=n.clientY,i.scale=t.scale}else g[n.identifier]={scale:t.scale,startPos:{x:n.clientX,y:n.clientY},x:n.clientX,y:n.clientY,time:(new Date).getTime()}}}function i(t){n(t)}function o(t){switch(t.touches.length){case 1:u(t.touches[0]);break;case 2:c(t)}return n(t),e.cancelEvent(t)}function r(t){var n=(new Date).getTime();0===t.touches.length&&w&&h(x);for(var i=0;i<t.changedTouches.length;i+=1){var o=t.changedTouches[i],r=g[o.identifier];if(r&&!r.wasPinch){var l={x:o.clientX,y:o.clientY},u=n-r.time,c=e.Point.distance(l,r.startPos);c>m||(u>f?(l.end=n,l.duration=u,s(l)):(l.time=n,a(l)))}}for(var d={},p=0;p<t.touches.length;p++)d[t.touches[p].identifier]=!0;for(var v in g)v in d||delete d[v];return e.cancelEvent(t)}function s(t){}function a(t){return y.length&&t.time-y[0].time<v?(l(t),void(y=[])):void(y=[t])}function l(t){var n=d.getZoom(),i=Math.round(n)+1,o=i-n,r=new e.Point(t.x,t.y);d.zoomByAbout(o,r)}function u(t){var e={x:t.clientX,y:t.clientY},n=g[t.identifier];d.panBy(e.x-n.x,e.y-n.y)}function c(t){var n=t.touches[0],i=t.touches[1],o=new e.Point(n.clientX,n.clientY),r=new e.Point(i.clientX,i.clientY),s=g[n.identifier],a=g[i.identifier];s.wasPinch=!0,a.wasPinch=!0;var l=e.Point.interpolate(o,r,.5);d.zoomByAbout(Math.log(t.scale)/Math.LN2-Math.log(s.scale)/Math.LN2,l);var u=e.Point.interpolate(s,a,.5);d.panBy(l.x-u.x,l.y-u.y),w=!0,x=l}function h(t){if(b){var e=d.getZoom(),n=Math.round(e);d.zoomByAbout(n-e,t)}w=!1}var d,p={id:"TouchHandler"},f=250,m=30,v=350,g={},y=[],b=!0,w=!1,x=null;return p.init=function(n){return d=n,t()?(e.addEvent(d.parent,"touchstart",i),e.addEvent(d.parent,"touchmove",o),e.addEvent(d.parent,"touchend",r),p):p},p.remove=function(){return t()?(e.removeEvent(d.parent,"touchstart",i),e.removeEvent(d.parent,"touchmove",o),e.removeEvent(d.parent,"touchend",r),p):p},p},e.CallbackManager=function(t,e){this.owner=t,this.callbacks={};for(var n=0;n<e.length;n++)this.callbacks[e[n]]=[]},e.CallbackManager.prototype={owner:null,callbacks:null,addCallback:function(t,e){"function"==typeof e&&this.callbacks[t]&&this.callbacks[t].push(e)},removeCallback:function(t,e){if("function"==typeof e&&this.callbacks[t])for(var n=this.callbacks[t],i=n.length,o=0;i>o;o++)if(n[o]===e){n.splice(o,1);break}},dispatchCallback:function(t,e){if(this.callbacks[t])for(var n=0;n<this.callbacks[t].length;n+=1)try{this.callbacks[t][n](this.owner,e)}catch(i){}}},e.RequestManager=function(){this.loadingBay=document.createDocumentFragment(),this.requestsById={},this.openRequestCount=0,this.maxOpenRequests=4,this.requestQueue=[],this.callbackManager=new e.CallbackManager(this,["requestcomplete","requesterror"])},e.RequestManager.prototype={loadingBay:null,requestsById:null,requestQueue:null,openRequestCount:null,maxOpenRequests:null,callbackManager:null,addCallback:function(t,e){this.callbackManager.addCallback(t,e)},removeCallback:function(t,e){this.callbackManager.removeCallback(t,e)},dispatchCallback:function(t,e){this.callbackManager.dispatchCallback(t,e)},clear:function(){this.clearExcept({})},clearRequest:function(t){t in this.requestsById&&delete this.requestsById[t];for(var e=0;e<this.requestQueue.length;e++){var n=this.requestQueue[e];n&&n.id==t&&(this.requestQueue[e]=null)}},clearExcept:function(t){for(var e=0;e<this.requestQueue.length;e++){var n=this.requestQueue[e];!n||n.id in t||(this.requestQueue[e]=null)}for(var i=this.loadingBay.childNodes,o=i.length-1;o>=0;o--){var r=i[o];r.id in t||(this.loadingBay.removeChild(r),this.openRequestCount--,r.src=r.coord=r.onload=r.onerror=null)}for(var s in this.requestsById)if(!(s in t)&&this.requestsById.hasOwnProperty(s)){var a=this.requestsById[s];delete this.requestsById[s],null!==a&&(a=a.id=a.coord=a.url=null)}},hasRequest:function(t){return t in this.requestsById},requestTile:function(t,e,n){if(!(t in this.requestsById)){var i={id:t,coord:e.copy(),url:n};this.requestsById[t]=i,n&&this.requestQueue.push(i)}},getProcessQueue:function(){if(!this._processQueue){var t=this;this._processQueue=function(){t.processQueue()}}return this._processQueue},processQueue:function(t){for(t&&this.requestQueue.length>8&&this.requestQueue.sort(t);this.openRequestCount<this.maxOpenRequests&&this.requestQueue.length>0;){var e=this.requestQueue.pop();if(e){this.openRequestCount++;var n=document.createElement("img");n.id=e.id,n.style.position="absolute",n.coord=e.coord,this.loadingBay.appendChild(n),n.onload=n.onerror=this.getLoadComplete(),n.src=e.url,e=e.id=e.coord=e.url=null}}},_loadComplete:null,getLoadComplete:function(){if(!this._loadComplete){var t=this;this._loadComplete=function(e){e=e||window.event;var n=e.srcElement||e.target;n.onload=n.onerror=null,t.loadingBay.removeChild(n),t.openRequestCount--,delete t.requestsById[n.id],"load"===e.type&&(n.complete||n.readyState&&"complete"==n.readyState)?t.dispatchCallback("requestcomplete",n):(t.dispatchCallback("requesterror",{element:n,url:""+n.src}),n.src=null),setTimeout(t.getProcessQueue(),0)}}return this._loadComplete}},e.Layer=function(t,n,i){this.parent=n||document.createElement("div"),this.parent.style.cssText="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; margin: 0; padding: 0; z-index: 0",this.name=i,this.levels={},this.requestManager=new e.RequestManager,this.requestManager.addCallback("requestcomplete",this.getTileComplete()),this.requestManager.addCallback("requesterror",this.getTileError()),t&&this.setProvider(t)},e.Layer.prototype={map:null,parent:null,name:null,enabled:!0,tiles:null,levels:null,requestManager:null,provider:null,_tileComplete:null,getTileComplete:function(){if(!this._tileComplete){var t=this;this._tileComplete=function(e,n){t.tiles[n.id]=n,t.positionTile(n),n.style.visibility="inherit",n.className="map-tile-loaded"}}return this._tileComplete},getTileError:function(){if(!this._tileError){var t=this;this._tileError=function(e,n){n.onload=n.onerror=null,t.tiles[n.element.id]=n.element,t.positionTile(n.element),n.element.style.visibility="hidden"}}return this._tileError},draw:function(){function t(t,e){if(t&&e){var i=t.coord,o=e.coord;if(i.zoom==o.zoom){var r=Math.abs(n.row-i.row-.5)+Math.abs(n.column-i.column-.5),s=Math.abs(n.row-o.row-.5)+Math.abs(n.column-o.column-.5);return s>r?1:r>s?-1:0}return i.zoom<o.zoom?1:i.zoom>o.zoom?-1:0}return t?1:e?-1:0}if(this.enabled&&this.map){var n=this.map.coordinate.zoomTo(Math.round(this.map.coordinate.zoom)),i=Math.round(this.map.coordinate.zoom),o=this.map.pointCoordinate(new e.Point(0,0)).zoomTo(i).container(),r=this.map.pointCoordinate(this.map.dimensions).zoomTo(i).container().right().down(),s={},a=this.createOrGetLevel(o.zoom),l=o.copy();for(l.column=o.column;l.column<r.column;l.column++)for(l.row=o.row;l.row<r.row;l.row++)for(var u=this.inventoryVisibleTile(a,l);u.length;)s[u.pop()]=!0;for(var c in this.levels)if(this.levels.hasOwnProperty(c)){var h=parseInt(c,10);if(h>=o.zoom-5&&h<o.zoom+2)continue;var d=this.levels[c];d.style.display="none";for(var p=this.tileElementsInLevel(d);p.length;)this.provider.releaseTile(p[0].coord),this.requestManager.clearRequest(p[0].coord.toKey()),d.removeChild(p[0]),p.shift()}for(var f=o.zoom-5,m=o.zoom+2,v=f;m>v;v++)this.adjustVisibleLevel(this.levels[v],v,s);this.requestManager.clearExcept(s),this.requestManager.processQueue(t)}},inventoryVisibleTile:function(t,e){var n=e.toKey(),i=[n];if(n in this.tiles){var o=this.tiles[n];return o.parentNode!=t&&(t.appendChild(o),"reAddTile"in this.provider&&this.provider.reAddTile(n,e,o)),i}if(!this.requestManager.hasRequest(n)){var r=this.provider.getTile(e);"string"==typeof r?this.addTileImage(n,e,r):r&&this.addTileElement(n,e,r)}for(var s=!1,a=e.zoom,l=1;a>=l;l++){var u=e.zoomBy(-l).container(),c=u.toKey();if(c in this.tiles){i.push(c),s=!0;break}}if(!s){var h=e.zoomBy(1);i.push(h.toKey()),h.column+=1,i.push(h.toKey()),h.row+=1,i.push(h.toKey()),h.column-=1,i.push(h.toKey())}return i},tileElementsInLevel:function(t){for(var e=[],n=t.firstChild;n;n=n.nextSibling)1==n.nodeType&&e.push(n);return e},adjustVisibleLevel:function(t,n,i){if(t){var o=1,r=this.map.coordinate.copy();if(!(t.childNodes.length>0))return t.style.display="none",!1;t.style.display="block",o=Math.pow(2,this.map.coordinate.zoom-n),r=r.zoomTo(n);for(var s=this.map.tileSize.x*o,a=this.map.tileSize.y*o,l=new e.Point(.5*this.map.dimensions.x,.5*this.map.dimensions.y),u=this.tileElementsInLevel(t);u.length;){var c=u.pop();i[c.id]?e.moveElement(c,{x:Math.round(l.x+(c.coord.column-r.column)*s),y:Math.round(l.y+(c.coord.row-r.row)*a),scale:o,width:this.map.tileSize.x,height:this.map.tileSize.y}):(this.provider.releaseTile(c.coord),this.requestManager.clearRequest(c.coord.toKey()),t.removeChild(c))}}},createOrGetLevel:function(t){if(t in this.levels)return this.levels[t];var e=document.createElement("div");return e.id=this.parent.id+"-zoom-"+t,e.style.cssText="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; margin: 0; padding: 0;",e.style.zIndex=t,this.parent.appendChild(e),this.levels[t]=e,e},addTileImage:function(t,e,n){this.requestManager.requestTile(t,e,n)},addTileElement:function(t,e,n){n.id=t,n.coord=e.copy(),this.positionTile(n)},positionTile:function(t){var n=this.map.coordinate.zoomTo(t.coord.zoom);t.style.cssText="position:absolute;-webkit-user-select:none;-webkit-user-drag:none;-moz-user-drag:none;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;-ms-transform-origin:0 0;width:"+this.map.tileSize.x+"px; height: "+this.map.tileSize.y+"px;",t.ondragstart=function(){return!1};var i=Math.pow(2,this.map.coordinate.zoom-t.coord.zoom);e.moveElement(t,{x:Math.round(.5*this.map.dimensions.x+(t.coord.column-n.column)*this.map.tileSize.x*i),y:Math.round(.5*this.map.dimensions.y+(t.coord.row-n.row)*this.map.tileSize.y*i),scale:i,width:this.map.tileSize.x,height:this.map.tileSize.y});var o=this.levels[t.coord.zoom];o.appendChild(t),Math.round(this.map.coordinate.zoom)==t.coord.zoom&&(o.style.display="block"),this.requestRedraw()},_redrawTimer:void 0,requestRedraw:function(){this._redrawTimer||(this._redrawTimer=setTimeout(this.getRedraw(),1e3))},_redraw:null,getRedraw:function(){if(!this._redraw){var t=this;this._redraw=function(){t.draw(),t._redrawTimer=0}}return this._redraw},setProvider:function(t){var e=null===this.provider;if(!e){this.requestManager.clear();for(var n in this.levels)if(this.levels.hasOwnProperty(n))for(var i=this.levels[n];i.firstChild;)this.provider.releaseTile(i.firstChild.coord),i.removeChild(i.firstChild)}this.tiles={},this.provider=t,e||this.draw()},enable:function(){return this.enabled=!0,this.parent.style.display="",this.draw(),this},disable:function(){return this.enabled=!1,this.requestManager.clear(),this.parent.style.display="none",this},destroy:function(){this.requestManager.clear(),this.requestManager.removeCallback("requestcomplete",this.getTileComplete()),this.requestManager.removeCallback("requesterror",this.getTileError()),this.provider=null,this.parent.parentNode&&this.parent.parentNode.removeChild(this.parent),this.map=null}},e.Map=function(t,n,i,o){if("string"==typeof t&&(t=document.getElementById(t),!t))throw"The ID provided to modest maps could not be found.";this.parent=t,this.parent.style.padding="0",this.parent.style.overflow="hidden";var r=e.getStyle(this.parent,"position");"relative"!=r&&"absolute"!=r&&(this.parent.style.position="relative"),this.layers=[],n||(n=[]),n instanceof Array||(n=[n]);for(var s=0;s<n.length;s++)this.addLayer(n[s]);if(this.projection=new e.MercatorProjection(0,e.deriveTransformation(-Math.PI,Math.PI,0,0,Math.PI,Math.PI,1,0,-Math.PI,-Math.PI,0,1)),this.tileSize=new e.Point(256,256),this.coordLimits=[new e.Coordinate(0,-(1/0),0),new e.Coordinate(1,1/0,0).zoomTo(18)],this.coordinate=new e.Coordinate(.5,.5,0),i?(this.autoSize=!1,this.parent.style.width=Math.round(i.x)+"px",this.parent.style.height=Math.round(i.y)+"px"):(i=new e.Point(this.parent.offsetWidth,this.parent.offsetHeight),this.autoSize=!0,e.addEvent(window,"resize",this.windowResize())),this.dimensions=i,this.callbackManager=new e.CallbackManager(this,["zoomed","panned","centered","extentset","resized","drawn"]),void 0===o)this.eventHandlers=[e.MouseHandler().init(this),e.TouchHandler().init(this)];else if(this.eventHandlers=o,o instanceof Array)for(var a=0;a<o.length;a++)o[a].init(this)},e.Map.prototype={parent:null,dimensions:null,projection:null,coordinate:null,tileSize:null,coordLimits:null,layers:null,callbackManager:null,eventHandlers:null,autoSize:null,toString:function(){return"Map(#"+this.parent.id+")"},addCallback:function(t,e){return this.callbackManager.addCallback(t,e),this},removeCallback:function(t,e){return this.callbackManager.removeCallback(t,e),this},dispatchCallback:function(t,e){return this.callbackManager.dispatchCallback(t,e),this},getHandler:function(t,e){var n=null,i=this.eventHandlers;if(e===!0){if(i=this.getHandler("MouseHandler",!1),!i)return n;i=i.handlers}if(!i)return n;for(var o=0;o<i.length;o++)if("string"==typeof i[o].id&&i[o].id===t){n=i[o];break}return n||"boolean"==typeof e?n:this.getHandler(t,!0)},disableHandler:function(t){var e=this.getHandler(t);return e&&"function"==typeof e.remove&&e.remove(),this},enableHandler:function(t){var e=this.getHandler(t);return e&&"function"==typeof e.remove&&e.init(this),this},removeHandler:function(t){var e=this.getHandler(t),n=this.eventHandlers.indexOf(e);if(-1===n){var i=this.getHandler("MouseHandler");return n=i.handlers.indexOf(e),void(-1!==n&&(e.remove(),i.handlers.splice(n,1)))}return e.remove(),this.eventHandlers.splice(n,1),e},addHandler:function(t){if(t.init(this),"string"!=typeof t.id)throw new Error("Handler lacks the required id attribute");return this.eventHandlers.push(t),this},windowResize:function(){if(!this._windowResize){var t=this;this._windowResize=function(n){t.dimensions=new e.Point(t.parent.offsetWidth,t.parent.offsetHeight),t.draw(),t.dispatchCallback("resized",[t.dimensions])}}return this._windowResize},setZoomRange:function(t,e){return this.coordLimits[0]=this.coordLimits[0].zoomTo(t),this.coordLimits[1]=this.coordLimits[1].zoomTo(e),this},zoomBy:function(t){return this.coordinate=this.enforceLimits(this.coordinate.zoomBy(t)),e.getFrame(this.getRedraw()),this.dispatchCallback("zoomed",t),this},zoomIn:function(){return this.zoomBy(1)},zoomOut:function(){return this.zoomBy(-1)},setZoom:function(t){return this.zoomBy(t-this.coordinate.zoom)},zoomByAbout:function(t,e){var n=this.pointLocation(e);this.coordinate=this.enforceLimits(this.coordinate.zoomBy(t));var i=this.locationPoint(n);return this.dispatchCallback("zoomed",t),this.panBy(e.x-i.x,e.y-i.y)},panBy:function(t,n){return this.coordinate.column-=t/this.tileSize.x,this.coordinate.row-=n/this.tileSize.y,this.coordinate=this.enforceLimits(this.coordinate),e.getFrame(this.getRedraw()),this.dispatchCallback("panned",[t,n]),this},panLeft:function(){return this.panBy(100,0)},panRight:function(){return this.panBy(-100,0)},panDown:function(){return this.panBy(0,-100)},panUp:function(){return this.panBy(0,100)},setCenter:function(t){return this.setCenterZoom(t,this.coordinate.zoom)},setCenterZoom:function(t,n){return this.coordinate=this.projection.locationCoordinate(t).zoomTo(parseFloat(n)||0),this.coordinate=this.enforceLimits(this.coordinate),e.getFrame(this.getRedraw()),this.dispatchCallback("centered",[t,n]),this},extentCoordinate:function(t,n){t instanceof e.Extent&&(t=t.toArray());for(var i,o,r=0;r<t.length;r++){var s=this.projection.locationCoordinate(t[r]);i?(i.row=Math.min(i.row,s.row),i.column=Math.min(i.column,s.column),i.zoom=Math.min(i.zoom,s.zoom),o.row=Math.max(o.row,s.row),o.column=Math.max(o.column,s.column),o.zoom=Math.max(o.zoom,s.zoom)):(i=s.copy(),o=s.copy())}var a=this.dimensions.x+1,l=this.dimensions.y+1,u=(o.column-i.column)/(a/this.tileSize.x),c=Math.log(u)/Math.log(2),h=i.zoom-(n?c:Math.ceil(c)),d=(o.row-i.row)/(l/this.tileSize.y),p=Math.log(d)/Math.log(2),f=i.zoom-(n?p:Math.ceil(p)),m=Math.min(h,f);m=Math.min(m,this.coordLimits[1].zoom),m=Math.max(m,this.coordLimits[0].zoom);var v=(i.row+o.row)/2,g=(i.column+o.column)/2,y=i.zoom;return new e.Coordinate(v,g,y).zoomTo(m)},setExtent:function(t,n){return this.coordinate=this.extentCoordinate(t,n),this.coordinate=this.enforceLimits(this.coordinate),e.getFrame(this.getRedraw()),this.dispatchCallback("extentset",t),this},setSize:function(t){return this.dimensions=new e.Point(t.x,t.y),this.parent.style.width=Math.round(this.dimensions.x)+"px",this.parent.style.height=Math.round(this.dimensions.y)+"px",this.autoSize&&(e.removeEvent(window,"resize",this.windowResize()),this.autoSize=!1),this.draw(),this.dispatchCallback("resized",this.dimensions),this},coordinatePoint:function(t){t.zoom!=this.coordinate.zoom&&(t=t.zoomTo(this.coordinate.zoom));var n=new e.Point(this.dimensions.x/2,this.dimensions.y/2);return n.x+=this.tileSize.x*(t.column-this.coordinate.column),n.y+=this.tileSize.y*(t.row-this.coordinate.row),n},pointCoordinate:function(t){var e=this.coordinate.copy();return e.column+=(t.x-this.dimensions.x/2)/this.tileSize.x,e.row+=(t.y-this.dimensions.y/2)/this.tileSize.y,e},locationCoordinate:function(t){return this.projection.locationCoordinate(t)},coordinateLocation:function(t){return this.projection.coordinateLocation(t)},locationPoint:function(t){return this.coordinatePoint(this.locationCoordinate(t))},pointLocation:function(t){return this.coordinateLocation(this.pointCoordinate(t))},getExtent:function(){return new e.Extent(this.pointLocation(new e.Point(0,0)),this.pointLocation(this.dimensions))},extent:function(t,e){return t?this.setExtent(t,e):this.getExtent()},getCenter:function(){return this.projection.coordinateLocation(this.coordinate);
},center:function(t){return t?this.setCenter(t):this.getCenter()},getZoom:function(){return this.coordinate.zoom},zoom:function(t){return void 0!==t?this.setZoom(t):this.getZoom()},getLayers:function(){return this.layers.slice()},getLayer:function(t){for(var e=0;e<this.layers.length;e++)if(t==this.layers[e].name)return this.layers[e]},getLayerAt:function(t){return this.layers[t]},addLayer:function(t){return this.layers.push(t),this.parent.appendChild(t.parent),t.map=this,this.coordinate&&e.getFrame(this.getRedraw()),this},removeLayer:function(t){for(var e=0;e<this.layers.length;e++)if(t==this.layers[e]||t==this.layers[e].name){this.removeLayerAt(e);break}return this},setLayerAt:function(t,n){if(0>t||t>=this.layers.length)throw new Error("invalid index in setLayerAt(): "+t);if(this.layers[t]!=n){if(t<this.layers.length){var i=this.layers[t];this.parent.insertBefore(n.parent,i.parent),i.destroy()}else this.parent.appendChild(n.parent);this.layers[t]=n,n.map=this,e.getFrame(this.getRedraw())}return this},insertLayerAt:function(t,n){if(0>t||t>this.layers.length)throw new Error("invalid index in insertLayerAt(): "+t);if(t==this.layers.length)this.layers.push(n),this.parent.appendChild(n.parent);else{var i=this.layers[t];this.parent.insertBefore(n.parent,i.parent),this.layers.splice(t,0,n)}return n.map=this,e.getFrame(this.getRedraw()),this},removeLayerAt:function(t){if(0>t||t>=this.layers.length)throw new Error("invalid index in removeLayer(): "+t);var e=this.layers[t];return this.layers.splice(t,1),e.destroy(),this},swapLayersAt:function(t,e){if(0>t||t>=this.layers.length||0>e||e>=this.layers.length)throw new Error("invalid index in swapLayersAt(): "+index);var n=this.layers[t],i=this.layers[e],o=document.createElement("div");return this.parent.replaceChild(o,i.parent),this.parent.replaceChild(i.parent,n.parent),this.parent.replaceChild(n.parent,o),this.layers[t]=i,this.layers[e]=n,this},enableLayer:function(t){var e=this.getLayer(t);return e&&e.enable(),this},enableLayerAt:function(t){var e=this.getLayerAt(t);return e&&e.enable(),this},disableLayer:function(t){var e=this.getLayer(t);return e&&e.disable(),this},disableLayerAt:function(t){var e=this.getLayerAt(t);return e&&e.disable(),this},enforceZoomLimits:function(t){var e=this.coordLimits;if(e){var n=e[0].zoom,i=e[1].zoom;t.zoom<n?t=t.zoomTo(n):t.zoom>i&&(t=t.zoomTo(i))}return t},enforcePanLimits:function(t){if(this.coordLimits){t=t.copy();var n=this.coordLimits[0].zoomTo(t.zoom),i=this.coordLimits[1].zoomTo(t.zoom),o=this.pointCoordinate(new e.Point(0,0)).zoomTo(t.zoom),r=this.pointCoordinate(this.dimensions).zoomTo(t.zoom);i.row-n.row<r.row-o.row?t.row=(i.row+n.row)/2:o.row<n.row?t.row+=n.row-o.row:r.row>i.row&&(t.row-=r.row-i.row),i.column-n.column<r.column-o.column?t.column=(i.column+n.column)/2:o.column<n.column?t.column+=n.column-o.column:r.column>i.column&&(t.column-=r.column-i.column)}return t},enforceLimits:function(t){return this.enforcePanLimits(this.enforceZoomLimits(t))},draw:function(){if(this.coordinate=this.enforceLimits(this.coordinate),this.dimensions.x<=0||this.dimensions.y<=0){if(!this.autoSize)return;var t=this.parent.offsetWidth,n=this.parent.offsetHeight;if(this.dimensions=new e.Point(t,n),0>=t||0>=n)return}for(var i=0;i<this.layers.length;i++)this.layers[i].draw();this.dispatchCallback("drawn")},_redrawTimer:void 0,requestRedraw:function(){this._redrawTimer||(this._redrawTimer=setTimeout(this.getRedraw(),1e3))},_redraw:null,getRedraw:function(){if(!this._redraw){var t=this;this._redraw=function(){t.draw(),t._redrawTimer=0}}return this._redraw},destroy:function(){for(var t=0;t<this.layers.length;t++)this.layers[t].destroy();this.layers=[],this.projection=null;for(var n=0;n<this.eventHandlers.length;n++)this.eventHandlers[n].remove();this.autoSize&&e.removeEvent(window,"resize",this.windowResize())}},e.mapByCenterZoom=function(t,n,i,o){var r=e.coerceLayer(n),s=new e.Map(t,r,!1);return s.setCenterZoom(i,o).draw(),s},e.mapByExtent=function(t,n,i,o){var r=e.coerceLayer(n),s=new e.Map(t,r,!1);return s.setExtent([i,o]).draw(),s},"undefined"!=typeof t&&t.exports&&(t.exports={Point:e.Point,Projection:e.Projection,MercatorProjection:e.MercatorProjection,LinearProjection:e.LinearProjection,Transformation:e.Transformation,Location:e.Location,MapProvider:e.MapProvider,Template:e.Template,Coordinate:e.Coordinate,deriveTransformation:e.deriveTransformation})}(a),o("undefined"!=typeof a?a:window.MM)}).call(t,void 0,void 0,void 0,void 0,function(t){e.exports=t})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,n){(function(n){var i=t;(function(t,e,n,o,r){(function(){var e,n,r,s,a=function(t,e){return function(){return t.apply(e,arguments)}},l=[].slice,u={}.hasOwnProperty,c=function(t,e){function n(){this.constructor=t}for(var i in e)u.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},h=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};e={options:["prefix","templateDelimiters","rootInterface","preloadData","handler"],extensions:["binders","formatters","components","adapters"],"public":{binders:{},components:{},formatters:{},adapters:{},prefix:"rv",templateDelimiters:["{","}"],rootInterface:".",preloadData:!0,handler:function(t,e,n){return this.call(t,e,n.view.models)},configure:function(t){var n,i,o,r;null==t&&(t={});for(o in t)if(r=t[o],"binders"===o||"components"===o||"formatters"===o||"adapters"===o)for(i in r)n=r[i],e[o][i]=n;else e["public"][o]=r},bind:function(t,n,i){var o;return null==n&&(n={}),null==i&&(i={}),o=new e.View(t,n,i),o.bind(),o},init:function(t,n,i){var o,r;return null==i&&(i={}),null==n&&(n=document.createElement("div")),t=e["public"].components[t],n.innerHTML=t.template.call(this,n),o=t.initialize.call(this,n,i),r=new e.View(n,o),r.bind(),r}}},window.jQuery||window.$?(s="on"in jQuery.prototype?["on","off"]:["bind","unbind"],n=s[0],r=s[1],e.Util={bindEvent:function(t,e,i){return jQuery(t)[n](e,i)},unbindEvent:function(t,e,n){return jQuery(t)[r](e,n)},getInputValue:function(t){var e;return e=jQuery(t),"checkbox"===e.attr("type")?e.is(":checked"):e.val()}}):e.Util={bindEvent:function(){return"addEventListener"in window?function(t,e,n){return t.addEventListener(e,n,!1)}:function(t,e,n){return t.attachEvent("on"+e,n)}}(),unbindEvent:function(){return"removeEventListener"in window?function(t,e,n){return t.removeEventListener(e,n,!1)}:function(t,e,n){return t.detachEvent("on"+e,n)}}(),getInputValue:function(t){var e,n,i,o;if("checkbox"===t.type)return t.checked;if("select-multiple"===t.type){for(o=[],n=0,i=t.length;i>n;n++)e=t[n],e.selected&&o.push(e.value);return o}return t.value}},e.TypeParser=function(){function t(){}return t.types={primitive:0,keypath:1},t.parse=function(t){return/^'.*'$|^".*"$/.test(t)?{type:this.types.primitive,value:t.slice(1,-1)}:"true"===t?{type:this.types.primitive,value:!0}:"false"===t?{type:this.types.primitive,value:!1}:"null"===t?{type:this.types.primitive,value:null}:"undefined"===t?{type:this.types.primitive,value:void 0}:isNaN(Number(t))===!1?{type:this.types.primitive,value:Number(t)}:{type:this.types.keypath,value:t}},t}(),e.TextTemplateParser=function(){function t(){}return t.types={text:0,binding:1},t.parse=function(t,e){var n,i,o,r,s,a,l;for(a=[],r=t.length,n=0,i=0;r>i;){if(n=t.indexOf(e[0],i),0>n){a.push({type:this.types.text,value:t.slice(i)});break}if(n>0&&n>i&&a.push({type:this.types.text,value:t.slice(i,n)}),i=n+e[0].length,n=t.indexOf(e[1],i),0>n){s=t.slice(i-e[1].length),o=a[a.length-1],(null!=o?o.type:void 0)===this.types.text?o.value+=s:a.push({type:this.types.text,value:s});break}l=t.slice(i,n).trim(),a.push({type:this.types.binding,value:l}),i=n+e[1].length}return a},t}(),e.View=function(){function t(t,n,i){var o,r,s,l,u,c,h,d,p,f,m,v,g;for(this.els=t,this.models=n,null==i&&(i={}),this.update=a(this.update,this),this.publish=a(this.publish,this),this.sync=a(this.sync,this),this.unbind=a(this.unbind,this),this.bind=a(this.bind,this),this.select=a(this.select,this),this.traverse=a(this.traverse,this),this.build=a(this.build,this),this.buildBinding=a(this.buildBinding,this),this.bindingRegExp=a(this.bindingRegExp,this),this.options=a(this.options,this),this.els.jquery||this.els instanceof Array||(this.els=[this.els]),p=e.extensions,u=0,h=p.length;h>u;u++){if(r=p[u],this[r]={},i[r]){f=i[r];for(o in f)s=f[o],this[r][o]=s}m=e["public"][r];for(o in m)s=m[o],null==(l=this[r])[o]&&(l[o]=s)}for(v=e.options,c=0,d=v.length;d>c;c++)r=v[c],this[r]=null!=(g=i[r])?g:e["public"][r];this.build()}return t.prototype.options=function(){var t,n,i,o,r;for(n={},r=e.extensions.concat(e.options),i=0,o=r.length;o>i;i++)t=r[i],n[t]=this[t];return n},t.prototype.bindingRegExp=function(){return new RegExp("^"+this.prefix+"-")},t.prototype.buildBinding=function(t,n,i,o){var r,s,a,l,u,c,h;return u={},h=function(){var t,e,n,i;for(n=o.split("|"),i=[],t=0,e=n.length;e>t;t++)c=n[t],i.push(c.trim());return i}(),r=function(){var t,e,n,i;for(n=h.shift().split("<"),i=[],t=0,e=n.length;e>t;t++)s=n[t],i.push(s.trim());return i}(),l=r.shift(),u.formatters=h,(a=r.shift())&&(u.dependencies=a.split(/\s+/)),this.bindings.push(new e[t](this,n,i,l,u))},t.prototype.build=function(){var t,n,i,o,r;for(this.bindings=[],n=function(t){return function(i){var o,r,s,a,l,u,c,h,d,p,f,m,v,g;if(3===i.nodeType){if(l=e.TextTemplateParser,(s=t.templateDelimiters)&&(h=l.parse(i.data,s)).length&&(1!==h.length||h[0].type!==l.types.text)){for(d=0,f=h.length;f>d;d++)c=h[d],u=document.createTextNode(c.value),i.parentNode.insertBefore(u,i),1===c.type&&t.buildBinding("TextBinding",u,null,c.value);i.parentNode.removeChild(i)}}else 1===i.nodeType&&(o=t.traverse(i));if(!o){for(v=function(){var t,e,n,o;for(n=i.childNodes,o=[],t=0,e=n.length;e>t;t++)a=n[t],o.push(a);return o}(),g=[],p=0,m=v.length;m>p;p++)r=v[p],g.push(n(r));return g}}}(this),r=this.els,i=0,o=r.length;o>i;i++)t=r[i],n(t);this.bindings.sort(function(t,e){var n,i;return((null!=(n=e.binder)?n.priority:void 0)||0)-((null!=(i=t.binder)?i.priority:void 0)||0)})},t.prototype.traverse=function(t){var n,i,o,r,s,a,l,u,c,h,d,p,f,m,v,g;for(r=this.bindingRegExp(),s="SCRIPT"===t.nodeName||"STYLE"===t.nodeName,m=t.attributes,h=0,p=m.length;p>h;h++)if(n=m[h],r.test(n.name)){if(u=n.name.replace(r,""),!(o=this.binders[u])){v=this.binders;for(a in v)c=v[a],"*"!==a&&-1!==a.indexOf("*")&&(l=new RegExp("^"+a.replace(/\*/g,".+")+"$"),l.test(u)&&(o=c))}o||(o=this.binders["*"]),o.block&&(s=!0,i=[n])}for(g=i||t.attributes,d=0,f=g.length;f>d;d++)n=g[d],r.test(n.name)&&(u=n.name.replace(r,""),this.buildBinding("Binding",t,u,n.value));return s||(u=t.nodeName.toLowerCase(),this.components[u]&&!t._bound&&(this.bindings.push(new e.ComponentBinding(this,t,u)),s=!0)),s},t.prototype.select=function(t){var e,n,i,o,r;for(o=this.bindings,r=[],n=0,i=o.length;i>n;n++)e=o[n],t(e)&&r.push(e);return r},t.prototype.bind=function(){var t,e,n,i,o;for(i=this.bindings,o=[],e=0,n=i.length;n>e;e++)t=i[e],o.push(t.bind());return o},t.prototype.unbind=function(){var t,e,n,i,o;for(i=this.bindings,o=[],e=0,n=i.length;n>e;e++)t=i[e],o.push(t.unbind());return o},t.prototype.sync=function(){var t,e,n,i,o;for(i=this.bindings,o=[],e=0,n=i.length;n>e;e++)t=i[e],o.push("function"==typeof t.sync?t.sync():void 0);return o},t.prototype.publish=function(){var t,e,n,i,o;for(i=this.select(function(t){var e;return null!=(e=t.binder)?e.publishes:void 0}),o=[],e=0,n=i.length;n>e;e++)t=i[e],o.push(t.publish());return o},t.prototype.update=function(t){var e,n,i,o,r,s,a;null==t&&(t={});for(n in t)i=t[n],this.models[n]=i;for(s=this.bindings,a=[],o=0,r=s.length;r>o;o++)e=s[o],a.push("function"==typeof e.update?e.update(t):void 0);return a},t}(),e.Binding=function(){function t(t,e,n,i,o){this.view=t,this.el=e,this.type=n,this.keypath=i,this.options=null!=o?o:{},this.getValue=a(this.getValue,this),this.update=a(this.update,this),this.unbind=a(this.unbind,this),this.bind=a(this.bind,this),this.publish=a(this.publish,this),this.sync=a(this.sync,this),this.set=a(this.set,this),this.eventHandler=a(this.eventHandler,this),this.formattedValue=a(this.formattedValue,this),this.parseTarget=a(this.parseTarget,this),this.observe=a(this.observe,this),this.setBinder=a(this.setBinder,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.formatterObservers={},this.model=void 0,this.setBinder()}return t.prototype.setBinder=function(){var t,e,n,i;if(!(this.binder=this.view.binders[this.type])){i=this.view.binders;for(t in i)n=i[t],"*"!==t&&-1!==t.indexOf("*")&&(e=new RegExp("^"+t.replace(/\*/g,".+")+"$"),e.test(this.type)&&(this.binder=n,this.args=new RegExp("^"+t.replace(/\*/g,"(.+)")+"$").exec(this.type),this.args.shift()))}return this.binder||(this.binder=this.view.binders["*"]),this.binder instanceof Function?this.binder={routine:this.binder}:void 0},t.prototype.observe=function(t,n,i){return e.sightglass(t,n,i,{root:this.view.rootInterface,adapters:this.view.adapters})},t.prototype.parseTarget=function(){var t;return t=e.TypeParser.parse(this.keypath),0===t.type?this.value=t.value:(this.observer=this.observe(this.view.models,this.keypath,this.sync),this.model=this.observer.target)},t.prototype.formattedValue=function(t){var n,i,o,r,s,a,u,c,h,d,p,f,m,v;for(v=this.formatters,r=d=0,f=v.length;f>d;r=++d){for(s=v[r],o=s.match(/[^\s']+|'([^']|'[^\s])*'|"([^"]|"[^\s])*"/g),a=o.shift(),s=this.view.formatters[a],o=function(){var t,n,r;for(r=[],t=0,n=o.length;n>t;t++)i=o[t],r.push(e.TypeParser.parse(i));return r}(),c=[],n=p=0,m=o.length;m>p;n=++p)i=o[n],c.push(0===i.type?i.value:((h=this.formatterObservers)[r]||(h[r]={}),(u=this.formatterObservers[r][n])?void 0:(u=this.observe(this.view.models,i.value,this.sync),this.formatterObservers[r][n]=u),u.value()));(null!=s?s.read:void 0)instanceof Function?t=s.read.apply(s,[t].concat(l.call(c))):s instanceof Function&&(t=s.apply(null,[t].concat(l.call(c))))}return t},t.prototype.eventHandler=function(t){var e,n;return n=(e=this).view.handler,function(i){return n.call(t,this,i,e)}},t.prototype.set=function(t){var e;return t=t instanceof Function&&!this.binder["function"]?this.formattedValue(t.call(this.model)):this.formattedValue(t),null!=(e=this.binder.routine)?e.call(this,this.el,t):void 0},t.prototype.sync=function(){var t,e;return this.set(function(){var n,i,o,r,s,a,l;if(this.observer){if(this.model!==this.observer.target){for(s=this.dependencies,n=0,o=s.length;o>n;n++)e=s[n],e.unobserve();if(this.dependencies=[],null!=(this.model=this.observer.target)&&(null!=(a=this.options.dependencies)?a.length:void 0))for(l=this.options.dependencies,i=0,r=l.length;r>i;i++)t=l[i],e=this.observe(this.model,t,this.sync),this.dependencies.push(e)}return this.observer.value()}return this.value}.call(this))},t.prototype.publish=function(){var t,e,n,i,o,r,s,a,u;if(this.observer){for(i=this.getValue(this.el),s=this.formatters.slice(0).reverse(),o=0,r=s.length;r>o;o++)e=s[o],t=e.split(/\s+/),n=t.shift(),(null!=(a=this.view.formatters[n])?a.publish:void 0)&&(i=(u=this.view.formatters[n]).publish.apply(u,[i].concat(l.call(t))));return this.observer.setValue(i)}},t.prototype.bind=function(){var t,e,n,i,o,r,s;if(this.parseTarget(),null!=(o=this.binder.bind)&&o.call(this,this.el),null!=this.model&&(null!=(r=this.options.dependencies)?r.length:void 0))for(s=this.options.dependencies,n=0,i=s.length;i>n;n++)t=s[n],e=this.observe(this.model,t,this.sync),this.dependencies.push(e);return this.view.preloadData?this.sync():void 0},t.prototype.unbind=function(){var t,e,n,i,o,r,s,a,l,u;for(null!=(s=this.binder.unbind)&&s.call(this,this.el),null!=(a=this.observer)&&a.unobserve(),l=this.dependencies,o=0,r=l.length;r>o;o++)i=l[o],i.unobserve();this.dependencies=[],u=this.formatterObservers;for(n in u){e=u[n];for(t in e)i=e[t],i.unobserve()}return this.formatterObservers={}},t.prototype.update=function(t){var e,n;return null==t&&(t={}),this.model=null!=(e=this.observer)?e.target:void 0,null!=(n=this.binder.update)?n.call(this,t):void 0},t.prototype.getValue=function(t){return this.binder&&null!=this.binder.getValue?this.binder.getValue.call(this,t):e.Util.getInputValue(t)},t}(),e.ComponentBinding=function(t){function n(t,e,n){var i,o,r,s,l,u,c;for(this.view=t,this.el=e,this.type=n,this.unbind=a(this.unbind,this),this.bind=a(this.bind,this),this.locals=a(this.locals,this),this.component=this.view.components[this.type],this["static"]={},this.observers={},this.upstreamObservers={},o=t.bindingRegExp(),u=this.el.attributes||[],s=0,l=u.length;l>s;s++)i=u[s],o.test(i.name)||(r=this.camelCase(i.name),h.call(null!=(c=this.component["static"])?c:[],r)>=0?this["static"][r]=i.value:this.observers[r]=i.value)}return c(n,t),n.prototype.sync=function(){},n.prototype.update=function(){},n.prototype.publish=function(){},n.prototype.locals=function(){var t,e,n,i,o,r;n={},o=this["static"];for(t in o)i=o[t],n[t]=i;r=this.observers;for(t in r)e=r[t],n[t]=e.value();return n},n.prototype.camelCase=function(t){return t.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()})},n.prototype.bind=function(){var t,n,i,o,r,s,a,l,u,c,h,d,p,f,m,v,g,y,b,w,x;if(!this.bound){f=this.observers;for(n in f)i=f[n],this.observers[n]=this.observe(this.view.models,i,function(t){return function(e){return function(){return t.componentView.models[e]=t.observers[e].value()}}}(this).call(this,n));this.bound=!0}if(null!=this.componentView)return this.componentView.bind();for(this.el.innerHTML=this.component.template.call(this),a=this.component.initialize.call(this,this.el,this.locals()),this.el._bound=!0,s={},m=e.extensions,c=0,d=m.length;d>c;c++){if(r=m[c],s[r]={},this.component[r]){v=this.component[r];for(t in v)l=v[t],s[r][t]=l}g=this.view[r];for(t in g)l=g[t],null==(u=s[r])[t]&&(u[t]=l)}for(y=e.options,h=0,p=y.length;p>h;h++)r=y[h],s[r]=null!=(b=this.component[r])?b:this.view[r];this.componentView=new e.View(this.el,a,s),this.componentView.bind(),w=this.observers,x=[];for(n in w)o=w[n],x.push(this.upstreamObservers[n]=this.observe(this.componentView.models,n,function(t){return function(e,n){return function(){return n.setValue(t.componentView.models[e])}}}(this).call(this,n,o)));return x},n.prototype.unbind=function(){var t,e,n,i,o;n=this.upstreamObservers;for(t in n)e=n[t],e.unobserve();i=this.observers;for(t in i)e=i[t],e.unobserve();return null!=(o=this.componentView)?o.unbind.call(this):void 0},n}(e.Binding),e.TextBinding=function(t){function e(t,e,n,i,o){this.view=t,this.el=e,this.type=n,this.keypath=i,this.options=null!=o?o:{},this.sync=a(this.sync,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.formatterObservers={}}return c(e,t),e.prototype.binder={routine:function(t,e){return t.data=null!=e?e:""}},e.prototype.sync=function(){return e.__super__.sync.apply(this,arguments)},e}(e.Binding),e["public"].binders.text=function(t,e){return null!=t.textContent?t.textContent=null!=e?e:"":t.innerText=null!=e?e:""},e["public"].binders.html=function(t,e){return t.innerHTML=null!=e?e:""},e["public"].binders.show=function(t,e){return t.style.display=e?"":"none"},e["public"].binders.hide=function(t,e){return t.style.display=e?"none":""},e["public"].binders.enabled=function(t,e){return t.disabled=!e},e["public"].binders.disabled=function(t,e){return t.disabled=!!e},e["public"].binders.checked={publishes:!0,priority:2e3,bind:function(t){return e.Util.bindEvent(t,"change",this.publish)},unbind:function(t){return e.Util.unbindEvent(t,"change",this.publish)},routine:function(t,e){var n;return"radio"===t.type?t.checked=(null!=(n=t.value)?n.toString():void 0)===(null!=e?e.toString():void 0):t.checked=!!e}},e["public"].binders.unchecked={publishes:!0,priority:2e3,bind:function(t){return e.Util.bindEvent(t,"change",this.publish)},unbind:function(t){return e.Util.unbindEvent(t,"change",this.publish)},routine:function(t,e){var n;return"radio"===t.type?t.checked=(null!=(n=t.value)?n.toString():void 0)!==(null!=e?e.toString():void 0):t.checked=!e}},e["public"].binders.value={publishes:!0,priority:3e3,bind:function(t){return"INPUT"!==t.tagName||"radio"!==t.type?(this.event="SELECT"===t.tagName?"change":"input",e.Util.bindEvent(t,this.event,this.publish)):void 0},unbind:function(t){return"INPUT"!==t.tagName||"radio"!==t.type?e.Util.unbindEvent(t,this.event,this.publish):void 0},routine:function(t,e){var n,i,o,r,s,a,l;if("INPUT"===t.tagName&&"radio"===t.type)return t.setAttribute("value",e);if(null!=window.jQuery){if(t=jQuery(t),(null!=e?e.toString():void 0)!==(null!=(r=t.val())?r.toString():void 0))return t.val(null!=e?e:"")}else if("select-multiple"===t.type){if(null!=e){for(l=[],i=0,o=t.length;o>i;i++)n=t[i],l.push(n.selected=(s=n.value,h.call(e,s)>=0));return l}}else if((null!=e?e.toString():void 0)!==(null!=(a=t.value)?a.toString():void 0))return t.value=null!=e?e:""}},e["public"].binders["if"]={block:!0,priority:4e3,bind:function(t){var e,n;return null==this.marker?(e=[this.view.prefix,this.type].join("-").replace("--","-"),n=t.getAttribute(e),this.marker=document.createComment(" rivets: "+this.type+" "+n+" "),this.bound=!1,t.removeAttribute(e),t.parentNode.insertBefore(this.marker,t),t.parentNode.removeChild(t)):void 0},unbind:function(){var t;return null!=(t=this.nested)?t.unbind():void 0},routine:function(t,n){var i,o,r,s;if(!!n==!this.bound){if(n){r={},s=this.view.models;for(i in s)o=s[i],r[i]=o;return(this.nested||(this.nested=new e.View(t,r,this.view.options()))).bind(),this.marker.parentNode.insertBefore(t,this.marker.nextSibling),this.bound=!0}return t.parentNode.removeChild(t),this.nested.unbind(),this.bound=!1}},update:function(t){var e;return null!=(e=this.nested)?e.update(t):void 0}},e["public"].binders.unless={block:!0,priority:4e3,bind:function(t){return e["public"].binders["if"].bind.call(this,t)},unbind:function(){return e["public"].binders["if"].unbind.call(this)},routine:function(t,n){return e["public"].binders["if"].routine.call(this,t,!n)},update:function(t){return e["public"].binders["if"].update.call(this,t)}},e["public"].binders["on-*"]={"function":!0,priority:1e3,unbind:function(t){return this.handler?e.Util.unbindEvent(t,this.args[0],this.handler):void 0},routine:function(t,n){return this.handler&&e.Util.unbindEvent(t,this.args[0],this.handler),e.Util.bindEvent(t,this.args[0],this.handler=this.eventHandler(n))}},e["public"].binders["each-*"]={block:!0,priority:4e3,bind:function(t){var e,n,i,o,r;if(null==this.marker)e=[this.view.prefix,this.type].join("-").replace("--","-"),this.marker=document.createComment(" rivets: "+this.type+" "),this.iterated=[],t.removeAttribute(e),t.parentNode.insertBefore(this.marker,t),t.parentNode.removeChild(t);else for(r=this.iterated,i=0,o=r.length;o>i;i++)n=r[i],n.bind()},unbind:function(t){var e,n,i,o,r;if(null!=this.iterated){for(o=this.iterated,r=[],n=0,i=o.length;i>n;n++)e=o[n],r.push(e.unbind());return r}},routine:function(t,n){var i,o,r,s,a,l,u,c,h,d,p,f,m,v,g,y,b,w,x,M,k;if(u=this.args[0],n=n||[],this.iterated.length>n.length)for(w=Array(this.iterated.length-n.length),f=0,g=w.length;g>f;f++)r=w[f],p=this.iterated.pop(),p.unbind(),this.marker.parentNode.removeChild(p.els[0]);for(s=m=0,y=n.length;y>m;s=++m)if(l=n[s],o={index:s},o[u]=l,null==this.iterated[s]){x=this.view.models;for(a in x)l=x[a],null==o[a]&&(o[a]=l);h=this.iterated.length?this.iterated[this.iterated.length-1].els[0]:this.marker,c=this.view.options(),c.preloadData=!0,d=t.cloneNode(!0),p=new e.View(d,o,c),p.bind(),this.iterated.push(p),this.marker.parentNode.insertBefore(d,h.nextSibling)}else this.iterated[s].models[u]!==l&&this.iterated[s].update(o);if("OPTION"===t.nodeName){for(M=this.view.bindings,k=[],v=0,b=M.length;b>v;v++)i=M[v],i.el===this.marker.parentNode&&"value"===i.type?k.push(i.sync()):k.push(void 0);return k}},update:function(t){var e,n,i,o,r,s,a,l;e={};for(n in t)i=t[n],n!==this.args[0]&&(e[n]=i);for(a=this.iterated,l=[],r=0,s=a.length;s>r;r++)o=a[r],l.push(o.update(e));return l}},e["public"].binders["class-*"]=function(t,e){var n;return n=" "+t.className+" ",!e==(-1!==n.indexOf(" "+this.args[0]+" "))?t.className=e?""+t.className+" "+this.args[0]:n.replace(" "+this.args[0]+" "," ").trim():void 0},e["public"].binders["*"]=function(t,e){return null!=e?t.setAttribute(this.type,e):t.removeAttribute(this.type)},e["public"].adapters["."]={id:"_rv",counter:0,weakmap:{},weakReference:function(t){var e,n,i;return t.hasOwnProperty(this.id)||(e=this.counter++,Object.defineProperty(t,this.id,{value:e})),(n=this.weakmap)[i=t[this.id]]||(n[i]={callbacks:{}})},cleanupWeakReference:function(t,e){return Object.keys(t.callbacks).length||t.pointers&&Object.keys(t.pointers).length?void 0:delete this.weakmap[e]},stubFunction:function(t,e){var n,i,o;return i=t[e],n=this.weakReference(t),o=this.weakmap,t[e]=function(){var e,r,s,a,l,u,c,h,d,p;a=i.apply(t,arguments),c=n.pointers;for(s in c)for(r=c[s],p=null!=(h=null!=(d=o[s])?d.callbacks[r]:void 0)?h:[],l=0,u=p.length;u>l;l++)(e=p[l])();return a}},observeMutations:function(t,e,n){var i,o,r,s,a,l;if(Array.isArray(t)){if(r=this.weakReference(t),null==r.pointers)for(r.pointers={},o=["push","pop","shift","unshift","sort","reverse","splice"],a=0,l=o.length;l>a;a++)i=o[a],this.stubFunction(t,i);if(null==(s=r.pointers)[e]&&(s[e]=[]),h.call(r.pointers[e],n)<0)return r.pointers[e].push(n)}},unobserveMutations:function(t,e,n){var i,o,r;return Array.isArray(t)&&null!=t[this.id]&&(o=this.weakmap[t[this.id]])&&(r=o.pointers[e])?((i=r.indexOf(n))>=0&&r.splice(i,1),r.length||delete o.pointers[e],this.cleanupWeakReference(o,t[this.id])):void 0},observe:function(t,e,n){var i,o,r;return i=this.weakReference(t).callbacks,null==i[e]&&(i[e]=[],o=Object.getOwnPropertyDescriptor(t,e),(null!=o?o.get:void 0)||(null!=o?o.set:void 0)||(r=t[e],Object.defineProperty(t,e,{enumerable:!0,get:function(){return r},set:function(o){return function(s){var a,l,u,c;if(s!==r&&(o.unobserveMutations(r,t[o.id],e),r=s,a=o.weakmap[t[o.id]])){if(i=a.callbacks,i[e])for(c=i[e].slice(),l=0,u=c.length;u>l;l++)n=c[l],h.call(i[e],n)>=0&&n();return o.observeMutations(s,t[o.id],e)}}}(this)}))),h.call(i[e],n)<0&&i[e].push(n),this.observeMutations(t[e],t[this.id],e)},unobserve:function(t,e,n){var i,o,r;return(r=this.weakmap[t[this.id]])&&(i=r.callbacks[e])?((o=i.indexOf(n))>=0&&(i.splice(o,1),i.length||delete r.callbacks[e]),this.unobserveMutations(t[e],t[this.id],e),this.cleanupWeakReference(r,t[this.id])):void 0},get:function(t,e){return t[e]},set:function(t,e,n){return t[e]=n}},e.factory=function(t){return e.sightglass=t,e["public"]._=e,e["public"]},"object"==typeof("undefined"!=typeof t&&null!==t?t.exports:void 0)?t.exports=e.factory(i("sightglass")):"function"==typeof o&&o.amd?o(["sightglass"],function(t){return this.rivets=e.factory(t)}):this.rivets=e.factory(sightglass)}).call(this),r("undefined"!=typeof rivets?rivets:window.rivets)}).call(n,void 0,void 0,void 0,void 0,function(t){e.exports=t})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(t,e,n){(function(t){(function(t,e,n,i,o){(function(){function e(t,e,i,o){return new n(t,e,i,o)}function n(t,e,n,i){this.options=i||{},this.options.adapters=this.options.adapters||{},this.obj=t,this.keypath=e,this.callback=n,this.objectPath=[],this.update=this.update.bind(this),this.parse(),o(this.target=this.realize())&&this.set(!0,this.key,this.target,this.callback)}function o(t){return"object"==typeof t&&null!==t}function r(t){throw new Error("[sightglass] "+t)}e.adapters={},n.tokenize=function(t,e,n){var i,o,r=[],s={i:n,path:""};for(i=0;i<t.length;i++)o=t.charAt(i),~e.indexOf(o)?(r.push(s),s={i:o,path:""}):s.path+=o;return r.push(s),r},n.prototype.parse=function(){var t,i,o=this.interfaces();o.length||r("Must define at least one adapter interface."),~o.indexOf(this.keypath[0])?(t=this.keypath[0],i=this.keypath.substr(1)):("undefined"==typeof(t=this.options.root||e.root)&&r("Must define a default root adapter."),i=this.keypath),this.tokens=n.tokenize(i,o,t),this.key=this.tokens.pop()},n.prototype.realize=function(){var t,e=this.obj,n=!1;return this.tokens.forEach(function(i,r){o(e)?("undefined"!=typeof this.objectPath[r]?e!==(t=this.objectPath[r])&&(this.set(!1,i,t,this.update),this.set(!0,i,e,this.update),this.objectPath[r]=e):(this.set(!0,i,e,this.update),this.objectPath[r]=e),e=this.get(i,e)):(n===!1&&(n=r),(t=this.objectPath[r])&&this.set(!1,i,t,this.update))},this),n!==!1&&this.objectPath.splice(n),e},n.prototype.update=function(){var t,e;(t=this.realize())!==this.target&&(o(this.target)&&this.set(!1,this.key,this.target,this.callback),o(t)&&this.set(!0,this.key,t,this.callback),e=this.value(),this.target=t,this.value()!==e&&this.callback())},n.prototype.value=function(){return o(this.target)?this.get(this.key,this.target):void 0},n.prototype.setValue=function(t){o(this.target)&&this.adapter(this.key).set(this.target,this.key.path,t)},n.prototype.get=function(t,e){return this.adapter(t).get(e,t.path)},n.prototype.set=function(t,e,n,i){var o=t?"observe":"unobserve";this.adapter(e)[o](n,e.path,i)},n.prototype.interfaces=function(){var t=Object.keys(this.options.adapters);return Object.keys(e.adapters).forEach(function(e){~t.indexOf(e)||t.push(e)}),t},n.prototype.adapter=function(t){return this.options.adapters[t.i]||e.adapters[t.i]},n.prototype.unobserve=function(){var t;this.tokens.forEach(function(e,n){(t=this.objectPath[n])&&this.set(!1,e,t,this.update)},this),o(this.target)&&this.set(!1,this.key,this.target,this.callback)},"undefined"!=typeof t&&t.exports?t.exports=e:"function"==typeof i&&i.amd?i([],function(){return this.sightglass=e}):this.sightglass=e}).call(this),o("undefined"!=typeof sightglass?sightglass:window.sightglass)}).call(t,void 0,void 0,void 0,void 0,function(t){e.exports=t})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(t,e,n){var i,o,r,s,a,l=t("./vendor/rivets.js"),u=t("./config/evidence.js"),c=(t("./config/dates.js"),t("./config/interface-text.js")),h=t("./map/map.js"),d=t("./config/overlay.js").overlayUrl,p=t("./templates/template.js"),f=t("./helpers/helper.js"),m=t("./helpers/fullscreen.js"),v=t("./helpers/styleUI.js"),g=t("./helpers/navigationUI.js"),y=t("./helpers/filtersUI.js"),b={type:"TAXON",key:"1"};e.exports=function(){"use strict";function t(t,i){var d,v,g;f.extend(b,i),E(),"all"==b.cat&&(b.cat=u.all),f.setFlag({obj:r.evidence.options,keys:b.cat?b.cat:u.defaultOptions,property:"active"}),t.innerHTML=t.innerHTML+p.html,d=t.querySelector(".gbifBasicMap_mapComponent"),v=d.querySelector(".gbifMapComponent_map"),f.supportsDisplayValue("flex")&&t.querySelector(".gbifBasicMapWrapper").classList.add("flex");try{l.bind(t,{filters:r,styling:s,shared:a,navigation:o,lang:c,map:h})}catch(y){console.error(JSON.stringify(y.message))}f.addEventListener(v,"click",o.hideAll),f.addEventListener(v,"touchstart",o.hideAll),g=s.maps.options[s.maps.selectedValue],h.init({basemap:g,parentElement:d,lat:b.lat,lng:b.lng,zoom:b.zoom,geoJson:b.geoJson}),w(),h.addExtentChangeListener(function(t){if("undefined"!=typeof ga){var n=h.hasOverlay()?b.type:"empty";ga("send","event","map","map_usage",n)}o.hideAll(),e(t)}),b.zoom||b.geoJson||f.getMetaData(i,n),o.simplifyInterface||m.addFullScreenButton({widget:t.querySelector(".gbifBasicMap"),button:t.querySelector(".fullscreen")})}function e(){var t,e,n,o=[];i&&(t=h.getExtent(),n=r.evidence.getActiveEvidenceAsArray(),n.length!=u.all.length&&n.forEach(function(t){t.filterAbbr.forEach(function(t){o.push(t)})}),e={HAS_GEOSPATIAL_ISSUE:!1,BASIS_OF_RECORD:o,GEOMETRY:f.buildVisibleGeometry(t.north,t.south,t.east,t.west)},r.dates.options[0].active||(e.YEAR=r.dates.options[r.dates.start].filterAbbr.start+","+r.dates.options[r.dates.end].filterAbbr.end),e[f.apiTranslate(b.type)]=b.key,i(f.serialiseObject(e,!0)))}function n(t){t.count>0&&C(t),t.resolution&&(s.size.selectedValue=t.resolution,w())}function w(){if(0===r.evidence.getActiveEvidenceAsArray().length)h.removeOverlay();else{
var t=s.maps.options[s.maps.selectedValue]["png-render-style"],n=f.serialiseObject({key:b.key,layer:M(r),type:b.type||"TAXON",resolution:s.size.selectedValue});h.setOverlay(d+"?x={X}&y={Y}&z={Z}&"+t+"&"+n)}r.dates.showDates=k(r),e()}function x(){h.toggleGeoJsonOverlay()}function M(t){var e,n,i=[];return e=t.evidence.getActiveEvidenceAsArray(),n=t.dates.options.filter(function(t){return t.active}),t.dates.undated.active&&n.push(t.dates.undated),e.forEach(function(t){t.dated?n.forEach(function(e){i.push(t.abbr+"_"+e.abbr)}):i.push(t.abbr)}),i}function k(t){var e=f.filterObjToArray(t.evidence.options,function(t){return t.active&&t.dated});return 0!==e.length}function E(){a={updateOverlay:w,toggleGeoJsonOverlay:x},r=y(b,a),s=v(b),o=g(b)}function C(t){h.setExtent(t)}function L(t){i=t}function z(t){h.addGeoJson(t),o.simplifyInterface||(s.information.show=!0)}return{createMap:t,setStateListener:L,setExtent:C,addGeoJson:z}}()},{"./config/dates.js":6,"./config/evidence.js":7,"./config/interface-text.js":8,"./config/overlay.js":9,"./helpers/filtersUI.js":12,"./helpers/fullscreen.js":13,"./helpers/helper.js":14,"./helpers/navigationUI.js":15,"./helpers/styleUI.js":16,"./map/map.js":18,"./templates/template.js":21,"./vendor/rivets.js":23}],5:[function(t,e,n){e.exports={defaultOption:"classic",options:{classic:{name:"Classic",url:"https://tile.gbif.org/3857/omt/{Z}/{X}/{Y}@1x.png?style=gbif-classic",attribution:"© <a href='https://openmaptiles.org/'>OpenMapTiles</a> © <a href='http://www.openstreetmap.org/copyright' target='_blank'>OpenStreetMap contributors</a>","png-render-style":"palette=yellows_reds",subdomains:[],enabled:!0},dark:{name:"Night",url:"https://tile.gbif.org/3857/omt/{Z}/{X}/{Y}@1x.png?style=gbif-dark",attribution:"© <a href='https://openmaptiles.org/'>OpenMapTiles</a> © <a href='http://www.openstreetmap.org/copyright' target='_blank'>OpenStreetMap contributors</a>","png-render-style":"saturation=true",subdomains:[],enabled:!1},ocean:{name:"Terrain",url:"http://server.arcgisonline.com/ArcGIS/rest/services/Ocean_Basemap/MapServer/tile/{Z}/{Y}/{X}.png",attribution:"Esri, DeLorme, FAO, USGS, NOAA, GEBCO, IHO-IOC GEBCO, NGS, NIWA","png-render-style":"palette=yellows_reds",subdomains:[],enabled:!1},satellite:{name:"Satellite",url:"http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{Z}/{Y}/{X}.png",attribution:"Esri, DeLorme, FAO, NOAA, DigitalGlobe, GeoEye, i-cubed, USDA, USGS, AEX, Getmapping, Aerogrid, IGN, IGP, swisstopo, and the GIS User Community","png-render-style":"palette=yellows_reds",subdomains:[],enabled:!1},light:{name:"High contrast",url:"https://tile.gbif.org/3857/omt/{Z}/{X}/{Y}@1x.png?style=gbif-light",attribution:"© <a href='https://openmaptiles.org/'>OpenMapTiles</a> © <a href='http://www.openstreetmap.org/copyright' target='_blank'>OpenStreetMap contributors</a>","png-render-style":"colors=%2C%2C%23CC0000FF",subdomains:[],enabled:!1},"grey-blue":{name:"Roads",url:"https://tile.gbif.org/3857/omt/{Z}/{X}/{Y}@1x.png?style=osm-bright",attribution:"© <a href='https://openmaptiles.org/'>OpenMapTiles</a> © <a href='http://www.openstreetmap.org/copyright' target='_blank'>OpenStreetMap contributors</a>","png-render-style":"palette=yellows_reds",subdomains:[],enabled:!1}}}},{}],6:[function(t,e,n){e.exports={start:0,end:12,undated:{active:!0,text:"No date",abbr:"NO_YEAR",filterAbbr:void 0},options:[{active:!1,text:"Pre 1900",abbr:"PRE_1900",filterAbbr:{start:"*",end:1900}},{active:!1,text:"1900s",abbr:"1900_1910",filterAbbr:{start:1900,end:1910}},{active:!1,text:"1910s",abbr:"1910_1920",filterAbbr:{start:1910,end:1920}},{active:!1,text:"1920s",abbr:"1920_1930",filterAbbr:{start:1920,end:1930}},{active:!1,text:"1930s",abbr:"1930_1940",filterAbbr:{start:1930,end:1940}},{active:!1,text:"1940s",abbr:"1940_1950",filterAbbr:{start:1940,end:1950}},{active:!1,text:"1950s",abbr:"1950_1960",filterAbbr:{start:1950,end:1960}},{active:!1,text:"1960s",abbr:"1960_1970",filterAbbr:{start:1960,end:1970}},{active:!1,text:"1970s",abbr:"1970_1980",filterAbbr:{start:1970,end:1980}},{active:!1,text:"1980s",abbr:"1980_1990",filterAbbr:{start:1980,end:1990}},{active:!1,text:"1990s",abbr:"1990_2000",filterAbbr:{start:1990,end:2e3}},{active:!1,text:"2000s",abbr:"2000_2010",filterAbbr:{start:2e3,end:2010}},{active:!1,text:"2010s",abbr:"2010_2020",filterAbbr:{start:2010,end:2020}},{active:!1,text:"2020s",abbr:"2020_2030",filterAbbr:{start:2020,end:2030}}]}},{}],7:[function(t,e,n){e.exports={defaultOptions:["sp","obs","oth","fossil","living"],all:["sp","obs","oth","fossil","living"],options:{sp:{text:"Preserved specimen",abbr:"SP",filterAbbr:["PRESERVED_SPECIMEN"],dated:!0},obs:{text:"Observation",abbr:"OBS",filterAbbr:["OBSERVATION","HUMAN_OBSERVATION","MACHINE_OBSERVATION"],dated:!0},oth:{text:"Other",abbr:"OTH",filterAbbr:["UNKNOWN","MATERIAL_SAMPLE","LITERATURE"],dated:!0},fossil:{text:"Fossil",comment:"No date",abbr:"FOSSIL",filterAbbr:["FOSSIL_SPECIMEN"],dated:!1},living:{text:"Living specimen",comment:"No date",abbr:"LIVING",filterAbbr:["LIVING_SPECIMEN"],dated:!1}}}},{}],8:[function(t,e,n){e.exports={filters:{headline:"Filters",evidence:{headline:"Basis of record",includeUndated:{text:"Show undated",description:"Show occurences without date. Fossils and Living Specimen are never dated."}},dates:{headline:"Date interval"}},styling:{headline:"Styling",basemap:{headline:"Map"},pointsize:{headline:"Point size"},overlay:{headline:"Context",showGeoJson:"Show coverage"}},navigation:{fullscreen:"Fullscreen"},map:{attribution:"Attribution & Disclaimer"}}},{}],9:[function(t,e,n){e.exports=function(){var t=document.baseUrlForTesting||"";return{overlayUrl:t+"density/tile.png",jsonUrlTemplate:t+"density/tile.json?key={key}&resolution=1&x=0&y=0&z=0&type={type}"}}()},{}],10:[function(t,e,n){e.exports={defaultOption:0,options:[{name:"Small",resolution:1},{name:"Medium",resolution:2},{name:"Large",resolution:4},{name:"X-Large",resolution:8}]}},{}],11:[function(t,e,n){e.exports={getItem:function(t){return t?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null},setItem:function(t,e,n,i,o,r){if(!t||/^(?:expires|max\-age|path|domain|secure)$/i.test(t))return!1;var s="";if(n)switch(n.constructor){case Number:s=n===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+n;break;case String:s="; expires="+n;break;case Date:s="; expires="+n.toUTCString()}return document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)+s+(o?"; domain="+o:"")+(i?"; path="+i:"")+(r?"; secure":""),!0},removeItem:function(t,e,n){return this.hasItem(t)?(document.cookie=encodeURIComponent(t)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(n?"; domain="+n:"")+(e?"; path="+e:""),!0):!1},hasItem:function(t){return t?new RegExp("(?:^|;\\s*)"+encodeURIComponent(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie):!1},keys:function(){for(var t=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),e=t.length,n=0;e>n;n++)t[n]=decodeURIComponent(t[n]);return t}}},{}],12:[function(t,e,n){var i=t("./helper.js"),o=t("../config/dates.js"),r=t("../config/evidence.js"),s=!1,a=!0;e.exports=function(t,e){function n(t,e){var n=e.index-filters.dates.start,i=filters.dates.end-e.index;return filters.dates.drag.dragging=!0,filters.dates.start>filters.dates.end?(e.filters.dates.start=e.index,e.filters.dates.end=e.index,h(filters),!0):(t.preventDefault(),filters.dates.drag.draggingStart=!1,filters.dates.drag.draggingBoth=!1,e.index==filters.dates.start&&filters.dates.start==filters.dates.end?filters.dates.end=e.index-1:Math.abs(n)==Math.abs(i)?0>n?(filters.dates.start=e.index,filters.dates.drag.draggingStart=!0):filters.dates.end=e.index:Math.abs(n)<Math.abs(i)?(filters.dates.drag.draggingStart=!0,0===n?filters.dates.start=e.index+1:filters.dates.start=e.index):0===i?filters.dates.end=e.index-1:filters.dates.end=e.index,void h(filters))}function l(t,e){var n,i,o=filters.dates.drag;o.dragging&&(n=document.elementFromPoint(t.touches[0].pageX,t.touches[0].pageY),i=parseInt(n.getAttribute("index")),u(t,{index:i}))}function u(t,e){var n,i,o=filters.dates.drag;o.dragging&&(n=e.index-filters.dates.start,i=filters.dates.end-e.index,filters.dates.drag.draggingBoth?(filters.dates.start=e.index,filters.dates.end=e.index):filters.dates.drag.draggingStart?filters.dates.start=Math.min(filters.dates.end,e.index):filters.dates.end=Math.max(e.index,filters.dates.start),h(filters))}function c(t){var n=filters.dates.drag;n.dragging&&(n.dragging=!1,e.updateOverlay(),"undefined"!=typeof ga&&ga("send","event","map_dates",filters.dates.start,filters.dates.end-filters.dates.start))}function h(t){var e,n=t.dates.options;for(t.dates.undated.active=!1,e=0;e<n.length;e++)e<t.dates.start?n[e].active=!1:e>t.dates.end?n[e].active=!1:n[e].active=!0,e==t.dates.start?n[e].endpoint=!0:e==t.dates.end?n[e].endpoint=!0:n[e].endpoint=!1}function d(t,e){if("undefined"!=typeof ga){var n=e.option.active?"deselect":"select";ga("send","event","map_evidence",n,e.option.abbr)}e.option.active=!e.option.active,e.shared.updateOverlay()}function p(t,e){if("undefined"!=typeof ga){var n=e.filters.dates.undated.active?"deselect":"select";ga("send","event","map_evidence",n,"show undated")}e.filters.dates.undated.active=!e.filters.dates.undated.active,e.shared.updateOverlay()}function f(t,e){return e.filters.undated.showDescription=!e.filters.undated.showDescription,!1}function m(){return i.filterObjToArray(filters.evidence.options,function(t){return t.active})}return i.addEventListener(window,"mouseup",c),i.addEventListener(window,"touchend",c),filters={undated:{toggleUndatedMouse:i.ghostClickWrap(p,s),toggleUndatedTouch:i.ghostClickWrap(p,a),showDescription:!1,toggleVisibilityMouse:i.ghostClickWrap(f,s),toggleVisibilityTouch:i.ghostClickWrap(f,a)},dates:{undated:o.undated,start:o.start,end:o.end,options:o.options,mouseDragStart:i.ghostClickWrap(n,s),touchDragStart:i.ghostClickWrap(n,a),mouseup:c,mouseenter:u,touchmove:l,drag:{dragging:!1},showDates:!0},evidence:{options:r.options,selectMouse:i.ghostClickWrap(d,s),selectTouch:i.ghostClickWrap(d,a),getActiveEvidenceAsArray:m}},h(filters),filters}},{"../config/dates.js":6,"../config/evidence.js":7,"./helper.js":14}],13:[function(t,e,n){var i=t("./helper.js");e.exports=function(){function t(t){t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()}function e(e){function n(){ga&&ga("send","event","map","fullscreen"),t(o)}var o=e.widget,r=e.button;i.addEventListener(r,"click",n)}return{addFullScreenButton:e}}()},{"./helper.js":14}],14:[function(t,e,n){e.exports=function(){function e(t,e){try{var n;n=new XMLHttpRequest,n.onreadystatechange=function(){n.readyState==XMLHttpRequest.DONE&&200==n.status&&e(n.responseText)},n.open("GET",t,!0),n.send()}catch(i){console.error("Could not get meta data from server.")}}function n(t,e,n){try{if(null===t)return;t.addEventListener(e,n)}catch(i){console.error("Not supported in legacy browsers. "+i+" Element: "+t)}}function i(t){if(0===t.count)return 1;var e=t.maximumLatitude-t.minimumLatitude,n=t.maximumLongitude-t.minimumLongitude,i=e*n/t.count,o=3-3/(1+i/f),r=Math.pow(2,Math.round(o));return r}function o(t,e){for(var n in e)e.hasOwnProperty(n)&&"undefined"!=typeof e[n]&&null!==e[n]&&(t[n]=e[n]);return t}function r(t,n){p=p.replace("{key}",t.key).replace("{type}",t.type),e(p,function(e){var o=JSON.parse(e);o.minimumLatitude=Math.max(-90,o.minimumLatitude-2),o.minimumLongitude-=2,o.maximumLatitude=Math.min(90,o.maximumLatitude+2),o.maximumLongitude+=2,t.resolution||(o.resolution=i(o)),n(o)})}function s(t,e){var n,i=[];for(n in t)t.hasOwnProperty(n)&&e(t[n])&&i.push(t[n]);return i}function a(t){var e;for(e in t.obj)t.obj.hasOwnProperty(e)&&(t.obj[e][t.property]=t.keys.indexOf(e)>-1);return t.obj}function l(t,e){return function(){(e?m:!m)&&t.apply(this,arguments)}}function u(t,e){function n(t,n){n=e?encodeURIComponent(n):n,i.push(t+"="+n)}var i=[];for(var o in t)if(t.hasOwnProperty(o))if("[object Array]"===Object.prototype.toString.call(t[o]))for(var r=0;r<t[o].length;r++)n(o,t[o][r]);else n(o,t[o]);return i.join("&")}function c(t){try{var e=document.createElement("detect");return e.style.display=t,e.style.display===t?!0:!1}catch(n){return!1}}function h(t){switch(t){case"TAXON":return"TAXON_KEY";case"DATASET":return"DATASET_KEY";default:return t}}function d(t,e,n,i){function o(t){for(;-180>t;)t+=360;for(;t>180;)t-=360;return t.toFixed(2)}n=o(n),i=o(i),t=o(t),e=o(e);var r="{w} {s},{w} {n},{e} {n},{e} {s},{w} {s}",s=r.replace(/{n}/g,t).replace(/{e}/g,n).replace(/{s}/g,e).replace(/{w}/g,i);return s}var p=t("../config/overlay.js").jsonUrlTemplate,f=2,m="ontouchstart"in window||navigator.msMaxTouchPoints;return{extend:o,getMetaData:r,serialiseObject:u,apiTranslate:h,buildVisibleGeometry:d,addEventListener:n,filterObjToArray:s,setFlag:a,ghostClickWrap:l,supportsTouch:m,supportsDisplayValue:c}}()},{"../config/overlay.js":9}],15:[function(t,e,n){var i=t("./helper.js"),o=!1,r=!0;e.exports=function(t){function e(t,e){e.navigation.evidence=!e.navigation.evidence}function n(){var t={};return t.ie9=/MSIE 9/i.test(navigator.userAgent),t.ie10=/MSIE 10/i.test(navigator.userAgent),t.ie11=/rv:11.0/i.test(navigator.userAgent),!(t.ie9||t.ie10||t.ie11)}function s(){a.filters=!1,a.styling=!1}var a={supportsTouch:i.supportsTouch,simplifyInterface:t.simplifyInterface,hideFullScreenButton:t.simplifyInterface||!n(),filters:!1,styling:!1,evidence:!1,showFilters:function(t,e){e.navigation.filters=!0,e.navigation.styling=!1},showStyling:function(t,e){e.navigation.filters=!1,e.navigation.styling=!0},toggleEvidenceTouch:i.ghostClickWrap(e,r),toggleEvidenceMouse:i.ghostClickWrap(e,o)};return a.hideAll=s,a}},{"./helper.js":14}],16:[function(t,e,n){var i=t("../config/baselayers.js"),o=t("../config/resolution.js"),r=t("./helper.js"),s=t("./cookie.js"),a=!1,l=!0;e.exports=function(t){function e(){var t;return s.hasItem("settings")&&(t=JSON.parse(s.getItem("settings")),i.options[t.baseMapId])?t.baseMapId:i.defaultOption}function n(t,e){"undefined"!=typeof ga&&ga("send","event","map_basemap","select",e.option.id),e.styling.maps.selectedValue=e.option.id,e.map.setBaseMap(e.option),s.setItem("settings",JSON.stringify({baseMapId:e.option.id})),e.shared.updateOverlay()}function u(t,e){"undefined"!=typeof ga&&ga("send","event","map_resolution","select",e.option.name,e.option.resolution),e.styling.size.selectedValue=e.option.resolution,e.shared.updateOverlay()}function c(t,e){e.styling.information.options.geojson.active=!e.styling.information.options.geojson.active,e.shared.toggleGeoJsonOverlay()}var h={maps:{options:i.options,selectedValue:i.options[t.style]?t.style:e(),select:n},size:{options:o.options,selectedValue:t.resolution||o.options[o.defaultOption].resolution,select:u},information:{show:!1,options:{geojson:{active:!0,click:r.ghostClickWrap(c,a),touch:r.ghostClickWrap(c,l)}}}};return h}},{"../config/baselayers.js":5,"../config/resolution.js":10,"./cookie.js":11,"./helper.js":14}],17:[function(t,e,n){var i=t("modestmaps");e.exports=function(){function t(t){function e(t){var e=Math.max(Math.min(85.0511,t[1]),-85.0511),n=Math.max(Math.min(180,t[0]),-180);return new i.Location(e,n)}function n(e,n){var i,o=t.locationPoint(n[0]);for(e.moveTo(o.x,o.y),i=1;i<n.length;i++)o=t.locationPoint(n[i]),e.lineTo(o.x,o.y);e.stroke()}function o(){d=[],r()}function r(){if(h.clearRect(0,0,c.width,c.height),!u){h.strokeStyle="deepskyblue",h.shadowColor="deepskyblue",h.shadowBlur=2,h.lineWidth=1,h.beginPath();for(var t=0;t<d.length;t++)n(h,d[t])}}function s(t){for(var n=t.features,i=n.length,o=0;i>o;o++){var s=n[o],a=[];if("Feature"==s.type){var l,u=s.geometry.type;if("Polygon"==u)l=s.geometry.coordinates[0];else{if("LineString"!=u)continue;l=s.geometry.coordinates}for(var c=0;c<l.length;c++){var h=e(l[c]);a.push(h),p.push(h)}d.push(a)}}r()}function a(){t.setExtent(p),r()}function l(){console.log("toggle geojson overlay poly"),u=!u,r()}var u,c=document.createElement("canvas"),h=c.getContext("2d"),d=[],p=[];return c.style.position="absolute",c.style.left="0px",c.style.top="0px",c.width=t.dimensions.x,c.height=t.dimensions.y,t.parent.appendChild(c),t.addCallback("drawn",r),t.addCallback("resized",function(){c.width=t.dimensions.x,c.height=t.dimensions.y,r()}),{add:s,clear:o,fitExtent:a,toggle:l}}function e(t){function e(t){var e=t.features,n=e.length;r=[];for(var i=0;n>i;i++){var o,a=e[i];if("Point"==a.geometry.type){o=document.createElement("div"),o.setAttribute("class","gbifBasicMapMarker");var l=o.appendChild(document.createElement("img"));l.setAttribute("src","images/marker-icon.png"),s.addMarker(o,a),r.push(o.location)}}}function n(){t.setExtent(r)}function o(){console.log("Marker toggle is not implemented")}var r,s=new i.MarkerLayer;return t.addLayer(s),{add:e,fitExtent:n,toggle:o}}return{createPolyOverlay:t,createMarkerOverlay:e}}()},{modestmaps:1}],18:[function(t,e,n){var i=t("maplib"),o=t("./geojsonOverlay.js");e.exports=function(){function e(t){var e,o,a=t.basemap;w=t.parentElement,e=w.querySelector(".gbifMapComponent_map"),o=new i.TemplatedLayer(a.url,a.subdomains),y=new i.Map(e,o,null,[i.DragHandler(),i.DoubleClickHandler(),i.MouseWheelHandler(),i.TouchHandler()]),y.setCenterZoom(new i.Location(t.lat||0,t.lng||0),t.zoom||1),y.setZoomRange(0,14),s(a.attribution),n(),r(),b=new i.TemplatedLayer(""),y.insertLayerAt(1,b),t.geoJson&&v(t.geoJson,"undefined"==typeof t.zoom)}function n(){i.addEvent(w.querySelector(".gbifMapComponent_zoom-in"),"click",function(t){return y.zoomIn(),i.cancelEvent(t)}),i.addEvent(w.querySelector(".gbifMapComponent_zoom-out"),"click",function(t){return y.zoomOut(),i.cancelEvent(t)})}function r(){y.addCallback("panned",p),y.addCallback("zoomed",p),y.addCallback("resized",p),y.addCallback("extentset",p)}function s(t){w.querySelector(".attribution>span").innerHTML=E+t}function a(t){var e=new i.TemplatedLayer(t.url,t.subdomains);y.getLayerAt(0)?y.setLayerAt(0,e):y.insertLayerAt(0,e),s(t.attribution)}function l(t){b=new i.TemplatedLayer(t),y.getLayerAt(1)?y.setLayerAt(1,b):y.insertLayerAt(1,b)}function u(){b&&b.disable()}function c(){return b&&b.enabled?!0:!1}function h(){return y.getExtent()}function d(t){var e,n=new i.Extent(new i.Location(t.minimumLatitude,t.minimumLongitude),new i.Location(t.maximumLatitude,t.maximumLongitude));y.setExtent(n,!1),e=Math.max(Math.min(y.getZoom(),6),1),y.setZoom(e)}function p(t,e){x&&clearTimeout(x),x=setTimeout(function(){f(C.extentChanges)},300)}function f(t){for(var e=0;e<t.length;e++)t[e](y.getExtent())}function m(t){C.extentChanges.push(t)}function v(t,e){var n,i,r=t.features;r.length;if(n=r.filter(function(t){return"Point"==t.geometry.type}),i=r.filter(function(t){return"Polygon"==t.geometry.type||"LineString"==t.geometry.type}),i.length>0){var s=o.createPolyOverlay(y);k.push(s),s.add(t),e&&s.fitExtent()}if(n.length>0){var a=o.createMarkerOverlay(y);k.push(a),a.add(t),e&&a.fitExtent()}}function g(){k.forEach(function(t){t.toggle()})}var y,b,w,x,M=t("./templates/template.js"),k=[],E=M.attribution,C={extentChanges:[]};return{init:e,setBaseMap:a,setOverlay:l,removeOverlay:u,hasOverlay:c,getExtent:h,setExtent:d,addExtentChangeListener:m,addGeoJson:v,toggleGeoJsonOverlay:g}}()},{"./geojsonOverlay.js":17,"./templates/template.js":19,maplib:22}],19:[function(t,e,n){var i='<span><a href="//www.gbif.org/disclaimer" target="_blank">Disclaimer</a> <a href="http://modestmaps.com/">Modest maps</a></span>';e.exports={attribution:i}},{}],20:[function(t,e,n){function i(t){return decodeURIComponent((new RegExp("[?|&]"+t+"=([^&;]+?)(&|#|;|$)").exec(location.search)||["",""])[1].replace(/\+/g,"%20"))||null}function o(){var t=i("cat"),e=i("simplifyInterface"),n=i("geojson"),o=i("point");return t=t?t.split(","):void 0,n=n?JSON.parse(n):void 0,o&&(o=o.split(","),e=null===e?!0:e,t=t||"none",n={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[parseFloat(o[1]),parseFloat(o[0])]}}]}),e=null!==e?e:!1,{type:i("type"),key:i("key")||1,resolution:i("resolution"),lat:i("lat"),lng:i("lng"),zoom:i("zoom")||i("default_zoom"),style:i("style"),geoJson:n,simplifyInterface:e,cat:t}}function r(t){return t.stopPropagation(),t.preventDefault(),t.returnValue=!1,!1}window.GBIF=window.GBIF||{},GBIF.basicMap=t("./basicMap.js");var s=o();GBIF.basicMap.createMap(document.body,s),GBIF.basicMap.setStateListener(function(t){parent.postMessage({origin:window.name,url:window.location.origin,searchUrl:t},"*")});var a=document.querySelector(".gbifBasicMap_mapComponent");a.addEventListener("scroll",r),a.addEventListener("mousewheel",r),a.addEventListener("DOMMouseScroll",r),a.addEventListener("MozMousePixelScroll",r)},{"./basicMap.js":4}],21:[function(t,e,n){var i='<div id="gbifBasicMap" class="gbifBasicMap" onselectstart="return false">\n    <div class="gbifBasicMapWrapper" rv-class-touch="navigation.supportsTouch" >\n        <div class="gbifBasicMap_mapComponent">\n        \n        <div class="gbifMapComponent">\n            <div class="gbifMapComponent_map"></div>\n            <div class="gbifMapComponent_zoom">\n                <div class="button gbifMapComponent_zoom-in"><i class="icon">+</i></div>\n                <div class="button gbifMapComponent_zoom-out"><i class="icon">-</i></div>\n            </div>\n            <div class="attribution"><div class="attribution_title" rv-text="lang.map.attribution">Attribution, Disclaimer</div> <span></span></div>\n            \n            <div class="button toggle filters-toggle" rv-class-show="true" rv-on-click="navigation.showFilters" rv-on-touchend="navigation.showFilters"><i class="gbifBasicMapIcon gbifBasicMapIcon-filter"></i></div>\n            <div class="button toggle styling-toggle" rv-class-show="true" rv-on-click="navigation.showStyling" rv-on-touchend="navigation.showStyling"><i class="gbifBasicMapIcon gbifBasicMapIcon-style"></i></div>\n            <div rv-unless="navigation.hideFullScreenButton" class="button toggle fullscreen" rv-title="lang.navigation.fullscreen"><i class="gbifBasicMapIcon gbifBasicMapIcon-fullscreen"></i></div>\n        </div>\n\n        </div>\n        <div rv-unless="navigation.simplifyInterface" class="gbifBasicMap_nav gbifBasicMap_nav_filters" rv-class-show="navigation.filters" rv-class-activedates="filters.dates.showDates">\n            <div class="gbifBasicMap_sidebarHeader" rv-on-click="navigation.toggleEvidenceMouse" rv-on-touchend="navigation.toggleEvidenceTouch">\n                <div><i class="gbifBasicMapIcon gbifBasicMapIcon-filter"></i></div>\n                <h2 rv-text="lang.filters.headline"></h2>\n            </div>\n            <ul>\n                <li class="gbifBasicMap_nav_evidence" rv-class-showevidence="navigation.evidence">\n                    <h3 class="section" rv-text="lang.filters.evidence.headline"></h3>\n                    <ul>\n                        <li class="undated" rv-class-active="filters.dates.undated.active">\n                            <div>\n                                <span>\n                                    <span rv-on-click="filters.undated.toggleUndatedMouse"  rv-on-touchend="filters.undated.toggleUndatedTouch" rv-text="lang.filters.evidence.includeUndated.text"></span>\n                                    <i class="gbifBasicMapIcon gbifBasicMapIcon-info" rv-on-click="filters.undated.toggleVisibilityMouse" rv-on-touchend="filters.undated.toggleVisibilityTouch"></i>\n                                </span>\n                                <span class="comment gbifBasicMap_description" rv-class-showdescription="filters.undated.showDescription"  rv-text="lang.filters.evidence.includeUndated.description"></span>\n                            </div>\n                        </li>\n                        <li rv-each-option="filters.evidence.options | objectList \'id\'" rv-class-active="option.active">\n                            <div rv-on-click="filters.evidence.selectMouse" rv-on-touchend="filters.evidence.selectTouch">\n                                <span rv-text="option.text"></span>\n                                <i rv-if="option.comment" class="comment" rv-text="option.comment"></i>\n                            </div>\n                        </li>\n                    </ul>\n                </li>\n                <li class="gbifBasicMap_nav_dates" rv-if="filters.dates.showDates">\n                    <h3 class="section" rv-text="lang.filters.dates.headline"></h3>\n                    <ul>\n                        <li rv-each-option="filters.dates.options | indexList" rv-class-active="option.active" rv-class-endpoint="option.endpoint">\n                            <div rv-text="option.text" rv-index="option.rv_index" role="button" rv-on-touchstart="filters.dates.touchDragStart" rv-on-touchmove="filters.dates.touchmove" rv-on-mousedown="filters.dates.mouseDragStart" rv-on-mouseenter="filters.dates.mouseenter">\n                            </div>\n                        </li>\n                    </ul>\n                </li>\n            </ul>\n        </div>\n\n        <div class="gbifBasicMap_nav gbifBasicMap_nav_styling" rv-class-show="navigation.styling">\n            <h2 rv-on-click="navigation.hideAll" rv-text="lang.styling.headline"></h2>\n            <ul>\n                <li class="maptype">\n                    <h3 rv-text="lang.styling.basemap.headline"></h3>\n                    <ul>\n                        <li rv-each-option="styling.maps.options | objectList \'id\'" rv-class-active="option.active">\n                            <label>\n                                <input type="radio" rv-value="option.id" rv-checked="styling.maps.selectedValue" name="baselayer" rv-on-click="styling.maps.select">\n                                <div rv-text="option.name"></div>\n                            </label>\n                        </li>\n                    </ul>\n                </li>\n                <li class="pointsize" rv-unless="navigation.simplifyInterface">\n                    <h3 rv-text="lang.styling.pointsize.headline"></h3>\n                    <ul>\n                        <li rv-each-option="styling.size.options" rv-class-active="option.active">\n                            <label>\n                                <input type="radio" rv-value="option.resolution" name="resolution" rv-checked="styling.size.selectedValue" rv-on-click="styling.size.select">\n                                <div rv-text="option.name"></div>\n                            </label>\n                        </li>\n                    </ul>\n                </li>\n                <li class="overlay" rv-if="styling.information.show">\n                    <h3 rv-text="lang.styling.overlay.headline"></h3>\n                    <ul>\n                        <li rv-class-active="styling.information.options.geojson.active">\n                            <div rv-on-click="styling.information.options.geojson.click" rv-on-touchend="styling.information.options.geojson.touch">\n                                <span rv-text="lang.styling.overlay.showGeoJson"></span>\n                            </div>\n                        </li>\n                    </ul>\n                </li>\n            </ul>\n        </div>\n    </div>\n</div>\n';e.exports={html:i}},{}],22:[function(t,e,n){var i={};i.modestmaps=t("modestmaps"),function(t){t.MarkerLayer=function(t){this.parent=t||document.createElement("div"),this.parent.style.cssText="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; margin: 0; padding: 0; z-index: 0",this.markers=[],this.resetPosition()},t.MarkerLayer.prototype={markers:null,position:null,lastCoord:null,draw:function(){var t=this.lastCoord,e=this.map.pointCoordinate({x:0,y:0});if(t)if(t.zoom==e.zoom){var n=this.map.coordinatePoint(t),i=this.map.coordinatePoint(e),o=n.x-i.x,r=n.y-i.y;this.onPanned(o,r)}else this.onZoomed();else this.onZoomed();this.lastCoord=e.copy()},onZoomed:function(){this.resetPosition(),this.repositionAllMarkers()},onPanned:function(t,e){this.position.x+=t,this.position.y+=e,this.parent.style.left=~~(this.position.x+.5)+"px",this.parent.style.top=~~(this.position.y+.5)+"px"},removeAllMarkers:function(){for(;this.markers.length>0;)this.removeMarker(this.markers[0])},coerceLocation:function(e){switch(typeof e){case"string":return t.Location.fromString(e);case"object":if("object"==typeof e.geometry){var n=e.geometry;switch(n.type){case"Point":var i=Number(n.coordinates[0]),o=Number(n.coordinates[1]);return new t.Location(o,i)}throw'Unable to get the location of GeoJSON "'+n.type+'" geometry!'}if(e instanceof t.Location||"undefined"!=typeof e.lat&&"undefined"!=typeof e.lon)return e;throw'Unknown location object; no "lat" and "lon" properties found!';case"undefined":throw'Location "undefined"'}},addMarker:function(t,e){return t&&e?(t.location=this.coerceLocation(e),t.coord=this.map.locationCoordinate(t.location),t.style.position="absolute",this.repositionMarker(t),this.parent.appendChild(t),this.markers.push(t),t):null},removeMarker:function(t){var e=this.markers.indexOf(t);return e>-1&&this.markers.splice(e,1),t.parentNode==this.parent&&this.parent.removeChild(t),t},resetPosition:function(){this.position=new t.Point(0,0),this.parent.style.left=this.parent.style.top="0px"},repositionMarker:function(t){if(t.coord){var e=this.map.coordinatePoint(t.coord);(this.position.x||this.position.y)&&(e.x-=this.position.x,e.y-=this.position.y),t.style.left=~~(e.x+.5)+"px",t.style.top=~~(e.y+.5)+"px"}},repositionAllMarkers:function(){for(var t=this.markers.length,e=0;t>e;e++)this.repositionMarker(this.markers[e])}},Array.prototype.indexOf||(Array.prototype.indexOf=function(t){"use strict";if(void 0===this||null===this)throw new TypeError;var e=Object(this),n=e.length>>>0;if(0===n)return-1;var i=0;if(arguments.length>0&&(i=Number(arguments[1]),i!==i?i=0:0!==i&&i!==1/0&&i!==-(1/0)&&(i=(i>0||-1)*Math.floor(Math.abs(i)))),i>=n)return-1;for(var o=i>=0?i:Math.max(n-Math.abs(i),0);n>o;o++)if(o in e&&e[o]===t)return o;return-1})}(i.modestmaps),e.exports=i.modestmaps},{modestmaps:1}],23:[function(t,e,n){var i=(t("sightglass"),t("rivets"));i.formatters.indexList=function(t,e){return function(){return e||(e=0),t.slice(e).map(function(t,n){return t.rv_index=n+e,t})}()},i.formatters.objectList=function(t,e){return function(){var n,i,o=[];for(i in t)t.hasOwnProperty(i)&&(n=t[i],n[e]=i,o.push(n));return o}()},i.binders.index=function(t,e){t.setAttribute("index",e)},e.exports=i},{rivets:2,sightglass:3}]},{},[20]);
